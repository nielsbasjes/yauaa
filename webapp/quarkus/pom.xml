<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Yet Another UserAgent Analyzer
  ~ Copyright (C) 2013-2022 Niels Basjes
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://maven.apache.org/POM/4.0.0"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <!--  <parent>-->
  <!--    <artifactId>yauaa-parent</artifactId>-->
  <groupId>nl.basjes.parse.useragent</groupId>
  <version>7.3.1-SNAPSHOT</version>
  <!--  </parent>-->
  <modelVersion>4.0.0</modelVersion>
  <!--  <packaging>war</packaging>-->

  <artifactId>yauaa-webapp-quarkus</artifactId>
  <name>Yauaa : Web Servlet (Quarkus)</name>

  <properties>
    <maven.compiler.source>17</maven.compiler.source>
    <maven.compiler.release>17</maven.compiler.release>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>

    <maven-compiler-plugin.version>3.8.1</maven-compiler-plugin.version>
    <maven-surefire-plugin.version>3.0.0-M7</maven-surefire-plugin.version>
    <git-commit-id-maven-plugin.version>5.0.0</git-commit-id-maven-plugin.version>

    <yauaa.version>7.3.0</yauaa.version>

    <lombok.version>1.18.24</lombok.version>

    <quarkus.platform.artifact-id>quarkus-bom</quarkus.platform.artifact-id>
    <quarkus.platform.group-id>io.quarkus.platform</quarkus.platform.group-id>
    <quarkus.platform.version>2.10.2.Final</quarkus.platform.version>
    <spring.version>5.3.21</spring.version>
    <skipITs>true</skipITs>

    <docker-maven-plugin.version>0.40.1</docker-maven-plugin.version>
    <docker.skip>false</docker.skip>
    <docker-based-package.phase>package</docker-based-package.phase>
    <docker-based-tests.skip>${skipITs}</docker-based-tests.skip>

    <!-- The default port on which to expose if you do "mvn docker:run" -->
    <yauaa.port>8080</yauaa.port>

    <maven-checkstyle-plugin.version>3.1.2</maven-checkstyle-plugin.version>
    <spotbugs-maven-plugin.version>4.7.0.0</spotbugs-maven-plugin.version>
    <spotbugs.version>4.7.0</spotbugs.version>
    <slf4j.version>1.7.36</slf4j.version>
    <log4j2.version>2.17.2</log4j2.version>

  </properties>

  <dependencyManagement>
    <dependencies>
      <dependency>
        <groupId>${quarkus.platform.group-id}</groupId>
        <artifactId>${quarkus.platform.artifact-id}</artifactId>
        <version>${quarkus.platform.version}</version>
        <type>pom</type>
        <scope>import</scope>
      </dependency>
    </dependencies>
  </dependencyManagement>

  <dependencies>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-arc</artifactId>
    </dependency>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-junit5</artifactId>
      <scope>test</scope>
    </dependency>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-container-image-jib</artifactId>
    </dependency>

    <dependency>
      <groupId>io.rest-assured</groupId>
      <artifactId>rest-assured</artifactId>
      <scope>test</scope>
    </dependency>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-resteasy-reactive-jackson</artifactId>
    </dependency>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-smallrye-openapi</artifactId>
    </dependency>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-spring-web</artifactId>
    </dependency>

    <dependency>
      <groupId>io.quarkus</groupId>
      <artifactId>quarkus-smallrye-graphql</artifactId>
    </dependency>

    <dependency>
      <groupId>nl.basjes.parse.useragent</groupId>
      <artifactId>yauaa</artifactId>
      <version>${yauaa.version}</version>
    </dependency>

    <dependency>
      <groupId>org.apache.logging.log4j</groupId>
      <artifactId>log4j-core</artifactId>
      <version>${log4j2.version}</version>
    </dependency>

    <dependency>
      <groupId>org.apache.logging.log4j</groupId>
      <artifactId>log4j-jcl</artifactId>
      <version>${log4j2.version}</version>
    </dependency>

    <dependency>
      <groupId>org.jboss.logmanager</groupId>
      <artifactId>log4j2-jboss-logmanager</artifactId>
    </dependency>

  </dependencies>

  <build>

    <plugins>
      <plugin>
        <groupId>${quarkus.platform.group-id}</groupId>
        <artifactId>quarkus-maven-plugin</artifactId>
        <version>${quarkus.platform.version}</version>
        <extensions>true</extensions>
        <executions>
          <execution>
            <goals>
              <goal>build</goal>
              <goal>generate-code</goal>
              <goal>generate-code-tests</goal>
            </goals>
          </execution>
        </executions>
      </plugin>

      <plugin>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>${maven-compiler-plugin.version}</version>
        <configuration>
          <compilerArgs>
            <arg>-parameters</arg>
          </compilerArgs>
        </configuration>
      </plugin>

      <plugin>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>${maven-surefire-plugin.version}</version>
        <configuration>
          <systemPropertyVariables>
            <java.util.logging.manager>org.jboss.logmanager.LogManager</java.util.logging.manager>
            <!--suppress UnresolvedMavenProperty -->
            <maven.home>${maven.home}</maven.home>
          </systemPropertyVariables>
        </configuration>
      </plugin>

      <plugin>
        <artifactId>maven-failsafe-plugin</artifactId>
        <version>${maven-surefire-plugin.version}</version>
        <executions>
          <execution>
            <goals>
              <goal>integration-test</goal>
              <goal>verify</goal>
            </goals>
            <configuration>
              <!--              <skip>${docker-based-tests.skip}</skip>-->
              <systemPropertyVariables>
                <native.image.path>${project.build.directory}/${project.build.finalName}-runner</native.image.path>
                <java.util.logging.manager>org.jboss.logmanager.LogManager</java.util.logging.manager>
                <!--suppress UnresolvedMavenProperty -->
                <maven.home>${maven.home}</maven.home>
              </systemPropertyVariables>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <!--      <plugin>-->
      <!--        <groupId>com.github.spotbugs</groupId>-->
      <!--        <artifactId>spotbugs-maven-plugin</artifactId>-->
      <!--        <version>${spotbugs-maven-plugin.version}</version>-->
      <!--      </plugin>-->

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-checkstyle-plugin</artifactId>
        <version>${maven-checkstyle-plugin.version}</version>
      </plugin>

      <plugin>
        <!-- Description: https://github.com/git-commit-id/git-commit-id-maven-plugin -->
        <groupId>io.github.git-commit-id</groupId>
        <artifactId>git-commit-id-maven-plugin</artifactId>
        <version>${git-commit-id-maven-plugin.version}</version>
        <executions>
          <execution>
            <id>get-the-git-infos</id>
            <phase>validate</phase>
            <goals>
              <goal>revision</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <dateFormat>yyyy-MM-dd '@' HH:mm:ss z</dateFormat>
        </configuration>
      </plugin>

    </plugins>

  </build>

  <profiles>
    <profile>
      <id>native</id>
      <activation>
        <property>
          <name>native</name>
        </property>
      </activation>
      <properties>
        <skipITs>false</skipITs>
        <quarkus.package.type>native</quarkus.package.type>
        <quarkus.native.additional-build-args>
          --initialize-at-run-time=nl.basjes.shaded.org.springframework.core.io.VfsUtils
        </quarkus.native.additional-build-args>

        <!-- Settings related to building the docker image. -->
        <quarkus.container-image.build>true</quarkus.container-image.build>
        <quarkus.smallrye-graphql.ui.always-include>true</quarkus.smallrye-graphql.ui.always-include>
        <quarkus.container-image.group>nielsbasjes</quarkus.container-image.group>
        <quarkus.container-image.image>yauaa-quarkus</quarkus.container-image.image>
        <quarkus.container-image.labels.name>yauaa</quarkus.container-image.labels.name>
        <quarkus.container-image.labels.build-date>${maven.build.timestamp}</quarkus.container-image.labels.build-date>
        <quarkus.container-image.labels.maintainer>Niels Basjes</quarkus.container-image.labels.maintainer>
        <quarkus.container-image.labels.vendor>Niels Basjes</quarkus.container-image.labels.vendor>
        <quarkus.container-image.labels.summary>Yauaa: Yet Another UserAgent Analyzer</quarkus.container-image.labels.summary>
        <quarkus.container-image.labels.url>https://yauaa.basjes.nl</quarkus.container-image.labels.url>
        <quarkus.container-image.labels.version>${project.version}</quarkus.container-image.labels.version>

        <!--suppress UnresolvedMavenProperty -->
        <quarkus.container-image.labels.vcs-ref>${git.commit.id}</quarkus.container-image.labels.vcs-ref>
        <quarkus.container-image.labels.vcs-type>git</quarkus.container-image.labels.vcs-type>

        <io.k8s.description>This is a java library that tries to parse and analyze the useragent
          string (and when available the User-Agent Client Hints) and extract as many relevant attributes as possible.</io.k8s.description>
        <io.k8s.display-name>Yauaa: Yet Another UserAgent Analyzer</io.k8s.display-name>

        <quarkus.container-image.labels.org.opencontainers.image.created>${maven.build.timestamp}</quarkus.container-image.labels.org.opencontainers.image.created>
        <quarkus.container-image.labels.org.opencontainers.image.authors>Niels Basjes</quarkus.container-image.labels.org.opencontainers.image.authors>
        <quarkus.container-image.labels.org.opencontainers.image.url>https://yauaa.basjes.nl</quarkus.container-image.labels.org.opencontainers.image.url>
        <quarkus.container-image.labels.org.opencontainers.image.documentation>https://yauaa.basjes.nl</quarkus.container-image.labels.org.opencontainers.image.documentation>
        <quarkus.container-image.labels.org.opencontainers.image.source>https://github.com/nielsbasjes/yauaa</quarkus.container-image.labels.org.opencontainers.image.source>
        <quarkus.container-image.labels.org.opencontainers.image.version>${project.version}</quarkus.container-image.labels.org.opencontainers.image.version>
        <!--suppress UnresolvedMavenProperty -->
        <quarkus.container-image.labels.org.opencontainers.image.revision>${git.commit.id}</quarkus.container-image.labels.org.opencontainers.image.revision>
        <quarkus.container-image.labels.org.opencontainers.image.vendor>Niels Basjes</quarkus.container-image.labels.org.opencontainers.image.vendor>
        <quarkus.container-image.labels.org.opencontainers.image.licenses>Apache-2.0</quarkus.container-image.labels.org.opencontainers.image.licenses>
        <quarkus.container-image.labels.org.opencontainers.image.title>Yauaa: Yet Another UserAgent Analyzer</quarkus.container-image.labels.org.opencontainers.image.title>

<!--        TODO: Check if this works-->
        <quarkus.container-image.labels.org.opencontainers.image.description>${io.k8s.description}</quarkus.container-image.labels.org.opencontainers.image.description>
      </properties>

    </profile>
  </profiles>

</project>
