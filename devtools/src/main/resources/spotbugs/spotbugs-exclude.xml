<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Yet Another UserAgent Analyzer
  ~ Copyright (C) 2013-2022 Niels Basjes
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<FindBugsFilter
  xmlns="https://github.com/spotbugs/filter/3.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="https://github.com/spotbugs/filter/3.0.0 https://raw.githubusercontent.com/spotbugs/spotbugs/3.1.0/spotbugs/etc/findbugsfilter.xsd">

  <!-- Irrelevant -->
  <Match>
    <Bug pattern="SE_NO_SERIALVERSIONID"/>
  </Match>

  <!-- The class responsible for doing the serialization is not serializable. -->
  <Match>
    <Class name="~.*KryoSerializer"/>
    <Bug pattern="SE_COMPARATOR_SHOULD_BE_SERIALIZABLE"/>
  </Match>

  <!-- False positive: This field cannot be null at that point -->
  <Match>
    <Bug pattern="NP_NULL_PARAM_DEREF"/>
    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>
    <Method name="loadResource"/>
  </Match>

  <!-- Not important: Only used in debugging scenarios -->
  <Match>
    <Bug pattern="SE_TRANSIENT_FIELD_NOT_RESTORED"/>
    <Class name="nl.basjes.parse.useragent.debug.DebugUserAgent"/>
  </Match>

  <!-- Not important: The places without synchronization are not important (setting verbose or not) -->
  <Match>
    <Bug pattern="IS2_INCONSISTENT_SYNC"/>
    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>
    <Field type="UserAgentTreeFlattener" name="flattener"/>
  </Match>

<!--  &lt;!&ndash; Verified it is correct &ndash;&gt;-->
<!--  <Match>-->
<!--    <Bug pattern="IS2_INCONSISTENT_SYNC"/>-->
<!--    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>-->
<!--    <Field name="matcherConfigs"/>-->
<!--  </Match>-->

<!--  &lt;!&ndash; Verified it is correct &ndash;&gt;-->
<!--  <Match>-->
<!--    <Bug pattern="IS2_INCONSISTENT_SYNC"/>-->
<!--    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>-->
<!--    <Field name="lookups"/>-->
<!--  </Match>-->

  <!-- Not important: Only show or not show some loading stats -->
  <Match>
    <Bug pattern="IS2_INCONSISTENT_SYNC"/>
    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>
    <Field type="boolean" name="showMatcherStats"/>
  </Match>

  <!-- Not important: Only used in debugging scenarios -->
  <Match>
    <Bug pattern="IS2_INCONSISTENT_SYNC"/>
    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>
    <Field type="boolean" name="verbose"/>
  </Match>

  <!-- False positive on configNodeTuple being null -->
  <Match>
    <Bug pattern="NP_NULL_PARAM_DEREF"/>
    <Class name="nl.basjes.parse.useragent.AbstractUserAgentAnalyzerDirect"/>
    <Method name="loadYaml"/>
<!--    <Field type="NodeTuple" name="configNodeTuple"/>-->
  </Match>

  <!-- Code generated by Antlr. -->
  <Match>
    <OR>
      <Bug pattern="MS_FINAL_PKGPROTECT"/>
      <Bug pattern="MS_PKGPROTECT"/>
      <Bug pattern="SF_SWITCH_NO_DEFAULT"/>
    </OR>
    <Class name="~nl\.basjes\.parse\.useragent\.parser\.UserAgent.*"/>
  </Match>

  <!-- These are actually read via the Drill specifics. -->
  <Match>
    <Bug pattern="URF_UNREAD_FIELD"/>
    <OR>
      <Class name="nl.basjes.parse.useragent.drill.ParseUserAgentFunction"/>
      <Class name="nl.basjes.parse.useragent.drill.ParseUserAgentFunctionField"/>
    </OR>
    <Field name="allFields"/>
  </Match>

  <!-- The GC is needed to get a good memory usage number -->
  <Match>
    <Class name="nl.basjes.parse.useragent.servlet.HumanHtml"/>
    <Method name="getMemoryUsage"/>
    <Bug pattern="DM_GC"/>
  </Match>

  <!-- Yes, a bit dodgy ... I know -->
  <Match>
    <Class name="nl.basjes.parse.useragent.servlet.ParseService"/>
    <Bug pattern="ST_WRITE_TO_STATIC_FROM_INSTANCE_METHOD"/>
    <Field name="initStartMoment"/>
  </Match>

  <!--  Not important -->
  <Match>
    <Class name="nl.basjes.parse.useragent.servlet.ParseService"/>
    <Bug pattern="MS_EXPOSE_REP"/>
    <Field name="userAgentAnalyzer"/>
  </Match>

  <!-- False positive: This is ensured by the Spring annotation   -->
  <!-- @ExceptionHandler({ YauaaIsBusyStarting.class })           -->
  <Match>
    <Class name="nl.basjes.parse.useragent.servlet.ParseService$RestResponseEntityExceptionHandler"/>
    <Method name="handleYauaaIsStarting"/>
    <Bug pattern="BC_UNCONFIRMED_CAST"/>
  </Match>

  <!-- Code generated by benchmark framework. -->
  <Match>
    <Class name="~nl\.basjes\.parse\.useragent\.benchmarks\.jmh_generated\..*"/>
  </Match>

</FindBugsFilter>
