<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.136.3"><meta name=generator content="Relearn 7.0.1"><meta name=description content="Introduction This is a User Defined Function for Apache Beam
Getting the UDF You can get the prebuilt UDF from maven central.
If you use a maven based project simply add this dependency to your project.
<dependency> <groupId>nl.basjes.parse.useragent</groupId> <artifactId>yauaa-beam</artifactId> <version>7.31.0</version> </dependency> Usage Assume you have a PCollection with your records. In most cases I see (clickstream data) these records (In this example this class is called “TestRecord”) contain the useragent string in a field and the parsed results must be added to these fields."><meta name=author content="Niels Basjes"><meta name=twitter:card content="summary"><meta name=twitter:title content="Apache Beam  |  Yauaa - Yet Another UserAgent Analyzer"><meta name=twitter:description content="Introduction This is a User Defined Function for Apache Beam
Getting the UDF You can get the prebuilt UDF from maven central.
If you use a maven based project simply add this dependency to your project.
<dependency> <groupId>nl.basjes.parse.useragent</groupId> <artifactId>yauaa-beam</artifactId> <version>7.31.0</version> </dependency> Usage Assume you have a PCollection with your records. In most cases I see (clickstream data) these records (In this example this class is called “TestRecord”) contain the useragent string in a field and the parsed results must be added to these fields."><meta property="og:url" content="/udf/apache-beam/index.html"><meta property="og:site_name" content="Yauaa - Yet Another UserAgent Analyzer"><meta property="og:title" content="Apache Beam  |  Yauaa - Yet Another UserAgent Analyzer"><meta property="og:description" content="Introduction This is a User Defined Function for Apache Beam
Getting the UDF You can get the prebuilt UDF from maven central.
If you use a maven based project simply add this dependency to your project.
<dependency> <groupId>nl.basjes.parse.useragent</groupId> <artifactId>yauaa-beam</artifactId> <version>7.31.0</version> </dependency> Usage Assume you have a PCollection with your records. In most cases I see (clickstream data) these records (In this example this class is called “TestRecord”) contain the useragent string in a field and the parsed results must be added to these fields."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="User Defined Functions"><meta itemprop=name content="Apache Beam  |  Yauaa - Yet Another UserAgent Analyzer"><meta itemprop=description content="Introduction This is a User Defined Function for Apache Beam
Getting the UDF You can get the prebuilt UDF from maven central.
If you use a maven based project simply add this dependency to your project.
<dependency> <groupId>nl.basjes.parse.useragent</groupId> <artifactId>yauaa-beam</artifactId> <version>7.31.0</version> </dependency> Usage Assume you have a PCollection with your records. In most cases I see (clickstream data) these records (In this example this class is called “TestRecord”) contain the useragent string in a field and the parsed results must be added to these fields."><meta itemprop=wordCount content="638"><title>Apache Beam | Yauaa - Yet Another UserAgent Analyzer</title><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/manifest.json><link rel=mask-icon href=/favicon/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#2d89ef"><meta name=msapplication-TileImage content="/favicon/mstile-144x144.png"><meta name=theme-color content="#ffffff"><link href=/css/fontawesome-all.min.css?1749237257 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css?1749237257 rel=stylesheet></noscript><link href=/css/nucleus.css?1749237257 rel=stylesheet><link href=/css/auto-complete.css?1749237257 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/auto-complete.css?1749237257 rel=stylesheet></noscript><link href=/css/perfect-scrollbar.min.css?1749237257 rel=stylesheet><link href=/css/fonts.css?1749237257 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css?1749237257 rel=stylesheet></noscript><link href=/css/theme.css?1749237257 rel=stylesheet><link href=/css/theme-yauaa.css?1749237257 rel=stylesheet id=R-variant-style><link href=/css/chroma-relearn-light.css?1749237257 rel=stylesheet id=R-variant-chroma-style><link href=/css/print.css?1749237257 rel=stylesheet media=print><script src=/js/variant.js?1749237257></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.variants&&variants.init(["yauaa"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><script type=text/javascript>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){t="https://wa.basjes.nl/",_paq.push(["setTrackerUrl",t+"wa.php"]),_paq.push(["setSiteId","1"]);var t,n=document,e=n.createElement("script"),s=n.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src=t+"wa.js",s.parentNode.insertBefore(e,s)}()</script></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=/udf/apache-beam/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#getting-the-udf>Getting the UDF</a></li><li><a href=#usage>Usage</a><ul><li><a href=#example-only-user-agent>Example: Only User-Agent</a></li><li><a href=#example-user-agent-client-hints>Example: User-Agent Client Hints</a></li></ul></li><li><a href=#immutable-instances-in-apache-beam>Immutable instances in Apache Beam</a></li><li><a href=#notes-on-defining-it-as-an-anonymous-class>NOTES on defining it as an anonymous class</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Yauaa</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/udf/index.html><span itemprop=name>User Defined Functions</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Apache Beam</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-edit" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=https://github.com/nielsbasjes/yauaa/tree/main/documentation/content/udf/Apache-Beam.md target=_blank title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable udf" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=apache-beam>Apache Beam</h1><h2 id=introduction>Introduction</h2><p>This is a User Defined Function for <a href=https://beam.apache.org rel=external target=_blank>Apache Beam</a></p><h2 id=getting-the-udf>Getting the UDF</h2><p>You can get the prebuilt UDF from <a href=https://central.sonatype.com/artifact/nl.basjes.parse.useragent/yauaa-beam/7.31.0/jar rel=external target=_blank>maven central</a>.</p><p>If you use a maven based project simply add this dependency to your project.</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;groupId&gt;</span>nl.basjes.parse.useragent<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;artifactId&gt;</span>yauaa-beam<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;version&gt;</span>7.31.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span></span></span></code></pre></div><h2 id=usage>Usage</h2><p>Assume you have a PCollection with your records.
In most cases I see (clickstream data) these records (In this example this class is called &ldquo;TestRecord&rdquo;) contain the useragent string in a field and the parsed results must be added to these fields.</p><p>Now you must do two things:</p><ol><li>Determine the names of the fields you need.</li><li>Add an instance of the (abstract) UserAgentAnalysisDoFn function and implement the functions as shown in the example below. Use the YauaaField annotation to get the setter for the requested fields.</li></ol><p>Note that the name of the setters is not important, the system looks at the annotation.</p><h3 id=example-only-user-agent>Example: Only User-Agent</h3><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>.<span style=color:#a6e22e>apply</span>(<span style=color:#e6db74>&#34;Extract Elements from Useragent and Client Hints&#34;</span>,
</span></span><span style=display:flex><span>    ParDo.<span style=color:#a6e22e>of</span>(<span style=color:#66d9ef>new</span> UserAgentAnalysisDoFn<span style=color:#f92672>&lt;</span>TestRecord<span style=color:#f92672>&gt;</span>(15000) { <span style=color:#75715e>// Setting the cacheSize</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUserAgentString</span>(TestRecord record) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> record.<span style=color:#a6e22e>useragent</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;DeviceClass&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setDC</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>deviceClass</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;AgentNameVersion&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setANV</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>agentNameVersion</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;OperatingSystemNameVersion&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setOSNV</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>operatingSystemNameVersion</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>)</span></span></code></pre></div><h3 id=example-user-agent-client-hints>Example: User-Agent Client Hints</h3><p>The only difference with the &ldquo;Only User-Agent&rdquo; implementation is that the <code>getRequestHeaders</code> is overridden.
The resulting map should have the <code>original request header names</code> as keys and the actual <code>header value</code> as the value.</p><p>To illustrate:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> requestHeaders <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> TreeMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;User-Agent&#34;</span>,                       <span style=color:#e6db74>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.0.0 Safari/537.36&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua&#34;</span>,                        <span style=color:#e6db74>&#34;\&#34; Not A;Brand\&#34;;v=\&#34;99\&#34;, \&#34;Chromium\&#34;;v=\&#34;100\&#34;, \&#34;Google Chrome\&#34;;v=\&#34;100\&#34;&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Arch&#34;</span>,                   <span style=color:#e6db74>&#34;\&#34;x86\&#34;&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Full-Version-List&#34;</span>,      <span style=color:#e6db74>&#34;\&#34; Not A;Brand\&#34;;v=\&#34;99.0.0.0\&#34;, \&#34;Chromium\&#34;;v=\&#34;100.0.4896.75\&#34;, \&#34;Google Chrome\&#34;;v=\&#34;100.0.4896.75\&#34;&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Mobile&#34;</span>,                 <span style=color:#e6db74>&#34;?0&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Model&#34;</span>,                  <span style=color:#e6db74>&#34;\&#34;\&#34;&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Platform&#34;</span>,               <span style=color:#e6db74>&#34;\&#34;Windows\&#34;&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Platform-Version&#34;</span>,       <span style=color:#e6db74>&#34;\&#34;0.1.0\&#34;&#34;</span>);
</span></span><span style=display:flex><span>requestHeaders.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;Sec-Ch-Ua-Wow64&#34;</span>,                  <span style=color:#e6db74>&#34;?0&#34;</span>);</span></span></code></pre></div><p>Using the analyzer whould then be something like this:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>.<span style=color:#a6e22e>apply</span>(<span style=color:#e6db74>&#34;Extract Elements from Useragent and Client Hints&#34;</span>,
</span></span><span style=display:flex><span>    ParDo.<span style=color:#a6e22e>of</span>(<span style=color:#66d9ef>new</span> UserAgentAnalysisDoFn<span style=color:#f92672>&lt;</span>TestRecord<span style=color:#f92672>&gt;</span>(15000) { <span style=color:#75715e>// Setting the cacheSize</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getRequestHeaders</span>(TestRecord element) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> element.<span style=color:#a6e22e>getHeaders</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;DeviceClass&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setDC</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>deviceClass</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;AgentNameVersion&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setANV</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>agentNameVersion</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;OperatingSystemNameVersion&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setOSNV</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>operatingSystemNameVersion</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>)</span></span></code></pre></div><h2 id=immutable-instances-in-apache-beam>Immutable instances in Apache Beam</h2><p>Apache Beam requires a DoFn to never modify the provided instance and to always return a new instance that is then passed to the next processing step.
To handle this in a generic way UserAgentAnalysisDoFn has a &ldquo;clone&rdquo; method that does this by means of doing a round trip through serialization. If you can do a more efficient way for your specific class then please override the clone method.</p><h2 id=notes-on-defining-it-as-an-anonymous-class>NOTES on defining it as an anonymous class</h2><p>An anonymous inner class in Java is <a href=https://stackoverflow.com/questions/319765/accessing-inner-anonymous-class-members rel=external target=_blank>by default private</a>.</p><p>If you define it as an anonymous inner class as shown above then the system will try to make this class to become public by means of the method .setAccessible(true).
There are situations in which this will fail (amongst others the SecurityManager can block this). If you run into such a scenario then simply &rsquo;not&rsquo; define it inline as an anonymous class and define it as a named (public) class instead.</p><p>So the earlier example will look something like this:</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyUserAgentAnalysisDoFn</span> <span style=color:#66d9ef>extends</span> UserAgentAnalysisDoFn<span style=color:#f92672>&lt;</span>TestRecord<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUserAgentString</span>(TestRecord record) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> record.<span style=color:#a6e22e>useragent</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;DeviceClass&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setDC</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>deviceClass</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unused&#34;</span>) <span style=color:#75715e>// Called via the annotation</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@YauaaField</span>(<span style=color:#e6db74>&#34;AgentNameVersion&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setANV</span>(TestRecord record, String value) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>record</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#a6e22e>agentNameVersion</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>and then in the topology simply do this</p><div class="highlight wrap-code"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>.<span style=color:#a6e22e>apply</span>(<span style=color:#e6db74>&#34;Extract Elements from Useragent&#34;</span>,
</span></span><span style=display:flex><span>  ParDo.<span style=color:#a6e22e>of</span>(<span style=color:#66d9ef>new</span> MyUserAgentAnalysisDoFn()));</span></span></code></pre></div><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=logo href=/><p class=logo-bar>Yauaa</p></a></div><script>window.index_js_url="/searchindex.js?1749237257"</script><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search><script>var contentLangs=["en"]</script><script src=/js/auto-complete.js?1749237257 defer></script><script src=/js/lunr/lunr.min.js?1749237257 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1749237257 defer></script><script src=/js/lunr/lunr.multi.min.js?1749237257 defer></script><script src=/js/lunr/lunr.en.min.js?1749237257 defer></script><script src=/js/search.js?1749237257 defer></script></div><div id=R-homelinks class="default-animation homelinks"><ul><li><a class=padding href=/index.html><i class='fas fa-home'></i> Yauaa</a></li></ul><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/expect/index.html><a class=padding href=/expect/index.html>What to expect</a><ul id=R-subsections-0cc162f4d70118f5b01edda6c8732e77 class=collapsible-menu></ul></li><li data-nav-id=/using/index.html><a class=padding href=/using/index.html>Using Yauaa</a><ul id=R-subsections-790b0ab426eab6dc92cf29e810f15854 class=collapsible-menu></ul></li><li class=parent data-nav-id=/udf/index.html><a class=padding href=/udf/index.html>User Defined Functions</a><ul id=R-subsections-b853d96ac1607b20a47f0b01f30f143a class=collapsible-menu><li class=active data-nav-id=/udf/apache-beam/index.html><a class=padding href=/udf/apache-beam/index.html>Apache Beam</a></li><li data-nav-id=/udf/apache-beam-sql/index.html><a class=padding href=/udf/apache-beam-sql/index.html>Apache Beam SQL</a></li><li data-nav-id=/udf/apache-drill/index.html><a class=padding href=/udf/apache-drill/index.html>Apache Drill</a></li><li data-nav-id=/udf/apache-flink/index.html><a class=padding href=/udf/apache-flink/index.html>Apache Flink</a></li><li data-nav-id=/udf/apache-flink-table/index.html><a class=padding href=/udf/apache-flink-table/index.html>Apache Flink Table/SQL</a></li><li data-nav-id=/udf/apache-hive/index.html><a class=padding href=/udf/apache-hive/index.html>Apache Hive</a></li><li data-nav-id=/udf/apache-nifi/index.html><a class=padding href=/udf/apache-nifi/index.html>Apache Nifi</a></li><li data-nav-id=/udf/apache-pig/index.html><a class=padding href=/udf/apache-pig/index.html>Apache Pig</a></li><li data-nav-id=/udf/commandline/index.html><a class=padding href=/udf/commandline/index.html>Commandline usage</a></li><li data-nav-id=/udf/elastic-logstash/index.html><a class=padding href=/udf/elastic-logstash/index.html>Elastic LogStash</a></li><li data-nav-id=/udf/elastic-search/index.html><a class=padding href=/udf/elastic-search/index.html>Elastic Search</a></li><li data-nav-id=/udf/logparser/index.html><a class=padding href=/udf/logparser/index.html>LogParser</a></li><li data-nav-id=/udf/snowflake/index.html><a class=padding href=/udf/snowflake/index.html>Snowflake</a></li><li data-nav-id=/udf/snowplow/index.html><a class=padding href=/udf/snowplow/index.html>Snowplow</a></li><li data-nav-id=/udf/trino/index.html><a class=padding href=/udf/trino/index.html>Trino</a></li></ul></li><li data-nav-id=/developer/index.html><a class=padding href=/developer/index.html>Development</a><ul id=R-subsections-f87f59ebc94679f99e2683cdd4170483 class=collapsible-menu></ul></li><li data-nav-id=/other/index.html><a class=padding href=/other/index.html>Other</a><ul id=R-subsections-dd17f32865650128ca32bc9ce5ee4fdf class=collapsible-menu></ul></li></ul></div><div id=R-shortcuts><div class="nav-title padding">More</div><ul class=space><li><a class=padding href=https://github.com/nielsbasjes/yauaa><i class='fab fa-git-square'></i> Git repo</a></li><li><a class=padding href=https://github.com/nielsbasjes/yauaa/discussions><i class='fa fa-comment-alt'></i> Discussions</a></li><li><a class=padding href=https://github.com/nielsbasjes/yauaa/blob/main/CHANGELOG.md><i class='fa fa-file-alt'></i> Changelog</a></li><li><a class=padding href=https://github.com/nielsbasjes/yauaa/issues><i class='fa fa-bug'></i> Issue tracker</a></li><li><a class=padding href=https://github.com/nielsbasjes/yauaa/actions><img alt="Github actions Build status" src="https://img.shields.io/github/actions/workflow/status/nielsbasjes/yauaa/build.yml?branch=main"></a></li><li><a class=padding href=https://app.codecov.io/gh/nielsbasjes/yauaa><img alt="Coverage Status" src=https://img.shields.io/codecov/c/github/nielsbasjes/yauaa></a></li><li><a class=padding href=https://www.apache.org/licenses/LICENSE-2.0.html><img alt=License src=https://img.shields.io/:license-apache-blue.svg></a></li><li><a class=padding href=https://central.sonatype.com/namespace/nl.basjes.parse.useragent><img alt="Maven Central" src="https://img.shields.io/maven-central/v/nl.basjes.parse.useragent/yauaa-parent.svg?label=Maven%20central"></a></li><li><a class=padding href=https://github.com/jvm-repo-rebuild/reproducible-central#nl.basjes.parse.useragent:yauaa><img alt="Reproducible Builds" src="https://img.shields.io/badge/Reproducible_Builds-ok-success?labelColor=1e5b96"></a></li><li><a class=padding href=https://github.com/nielsbasjes/yauaa/stargazers><img alt="GitHub stars" src="https://img.shields.io/github/stars/nielsbasjes/yauaa?label=GitHub%20stars"></a></li><li><a class=padding href=https://hub.docker.com/r/nielsbasjes/yauaa><img alt="Docker Image" src="https://img.shields.io/docker/v/nielsbasjes/yauaa/latest?arch=amd64&label=Docker%20image"></a></li><li><a class=padding href=https://hub.docker.com/r/nielsbasjes/yauaa><img alt="Docker Pulls" src="https://img.shields.io/docker/pulls/nielsbasjes/yauaa?label=Docker%20pulls"></a></li><li><a class=padding href=https://github.com/sponsors/nielsbasjes><img alt="If this project has business value for you then dont hesitate to support me with a small donation." src=https://img.shields.io/badge/Sponsor%20me-via%20Github-darkgreen.svg></a></li><li><a class=padding href=https://www.paypal.me/nielsbasjes><img alt="If this project has business value for you then dont hesitate to support me with a small donation." src=https://img.shields.io/badge/Donations-via%20Paypal-red.svg></a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Language</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-en value=#R-select-language-en data-url=/udf/apache-beam/index.html lang=en-us selected></option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Theme</label>
<select id=R-select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=R-select-variant-yauaa value=yauaa selected>Yauaa</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><p><img alt="NO AI: Deterministic, Predictable, Secure, Private, Offline, Safe, Fast" src=/NoAI_DeterministicPrivateFast-250x250.png></p><p><b>Yauaa does not use any AI at runtime.</b></p><p><i>This makes it Deterministic, Predictable, Offline, Secure, Private, Safe and Fast</i></p><p>&copy;2013-2025 by <a href=https://niels.basjes.nl>Niels Basjes</a></p></div></div></div></aside><script src=/js/clipboard.min.js?1749237257 defer></script><script src=/js/perfect-scrollbar.min.js?1749237257 defer></script><script src=/js/theme.js?1749237257 defer></script></body></html>