#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2019 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
config:
# Testcases for apps

# https://user-agents.me/cfnetwork-version-list
# If you create an iOS app and retrieve data from a webserver,
# the app will create an default user agent as "AppName/version CFNetwork/version Darwin/version".

- matcher:
    require:
    - 'agent.(2)product.(1)name="CFNetwork"'
    extract:
    - 'DeviceClass                         :     10 :"Mobile"'
    - 'DeviceBrand                         :     10 :"Apple"'
    - 'DeviceName                          :     10 :"iOS Device"'
    - 'OperatingSystemClass                :     10 :"Mobile"'
    - 'OperatingSystemName                 :     10 :"Darwin (iOS)"'
    - 'OperatingSystemVersion              :     10 :agent.(3)product.(1)name="Darwin"^.version'
    - 'LayoutEngineClass                   :     10 :"Mobile App"'
    - 'LayoutEngineName                    :     10 :agent.(1)product.(1)name'
    - 'LayoutEngineVersion                 :     10 :agent.(1)product.(1)version'
    - 'AgentClass                          :     10 :"Mobile App"'
    - 'AgentName                           :     10 :agent.(1)product.(1)name'
    - 'AgentVersion                        :     10 :agent.(1)product.(1)version'

- matcher:
    require:
    - 'agent.(2)product.(1)name="CFNetwork"'
    - 'agent.(1)product.(1)comments.(1)entry="unknown version"'
    extract:
    - 'DeviceClass                         :     10 :"Mobile"'
    - 'DeviceBrand                         :     10 :"Apple"'
    - 'DeviceName                          :     10 :"iOS Device"'
    - 'OperatingSystemClass                :     10 :"Mobile"'
    - 'OperatingSystemName                 :     10 :"Darwin (iOS)"'
    - 'OperatingSystemVersion              :     10 :agent.(3)product.(1)name="Darwin"^.version'
    - 'LayoutEngineClass                   :     10 :"Mobile App"'
    - 'LayoutEngineName                    :     10 :agent.(1)product.(1)name'
    - 'LayoutEngineVersion                 :      6 :"??"'
    - 'AgentClass                          :     10 :"Mobile App"'
    - 'AgentName                           :     10 :agent.(1)product.(1)name'
    - 'AgentVersion                        :      6 :"??"'

- test:
    input:
      user_agent_string: 'bol.com/94 CFNetwork/758.2.8 Darwin/15.0.0'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '15.0.0'
      OperatingSystemVersionMajor          : '15'
      OperatingSystemNameVersion           : 'Darwin (iOS) 15.0.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 15'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'bol.com'
      LayoutEngineVersion                  : '94'
      LayoutEngineVersionMajor             : '94'
      LayoutEngineNameVersion              : 'bol.com 94'
      LayoutEngineNameVersionMajor         : 'bol.com 94'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'bol.com'
      AgentVersion                         : '94'
      AgentVersionMajor                    : '94'
      AgentNameVersion                     : 'bol.com 94'
      AgentNameVersionMajor                : 'bol.com 94'
      AgentInformationUrl                  : 'bol.com'

- test:
    input:
      user_agent_string: 'iButler-Swift/1 CFNetwork/711.3.15 Darwin/14.0.0'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '14.0.0'
      OperatingSystemVersionMajor          : '14'
      OperatingSystemNameVersion           : 'Darwin (iOS) 14.0.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 14'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'iButler-Swift'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'iButler-Swift 1'
      LayoutEngineNameVersionMajor         : 'iButler-Swift 1'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'iButler-Swift'
      AgentVersion                         : '1'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'iButler-Swift 1'
      AgentNameVersionMajor                : 'iButler-Swift 1'

- test:
    input:
      user_agent_string: 'GoodReader4/100 CFNetwork/711.5.6 Darwin/14.0.0'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '14.0.0'
      OperatingSystemVersionMajor          : '14'
      OperatingSystemNameVersion           : 'Darwin (iOS) 14.0.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 14'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'GoodReader4'
      LayoutEngineVersion                  : '100'
      LayoutEngineVersionMajor             : '100'
      LayoutEngineNameVersion              : 'GoodReader4 100'
      LayoutEngineNameVersionMajor         : 'GoodReader4 100'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'GoodReader4'
      AgentVersion                         : '100'
      AgentVersionMajor                    : '100'
      AgentNameVersion                     : 'GoodReader4 100'
      AgentNameVersionMajor                : 'GoodReader4 100'

- test:
    input:
      user_agent_string: 'iCoreService (unknown version) CFNetwork/720.2.4 Darwin/14.1.0 (x86_64)'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '14.1.0'
      OperatingSystemVersionMajor          : '14'
      OperatingSystemNameVersion           : 'Darwin (iOS) 14.1.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 14'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'iCoreService'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'iCoreService ??'
      LayoutEngineNameVersionMajor         : 'iCoreService ??'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'iCoreService'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'iCoreService ??'
      AgentNameVersionMajor                : 'iCoreService ??'

- test:
    input:
      user_agent_string: 'MoxDocumentApplication (unknown version) CFNetwork/720.5.7 Darwin/14.5.0 (x86_64)'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '14.5.0'
      OperatingSystemVersionMajor          : '14'
      OperatingSystemNameVersion           : 'Darwin (iOS) 14.5.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 14'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'MoxDocumentApplication'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'MoxDocumentApplication ??'
      LayoutEngineNameVersionMajor         : 'MoxDocumentApplication ??'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'MoxDocumentApplication'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'MoxDocumentApplication ??'
      AgentNameVersionMajor                : 'MoxDocumentApplication ??'

- test:
    input:
      user_agent_string: 'com.ddeville.llwebkit.linkchecker/1 CFNetwork/760.2.6 Darwin/15.3.0 (x86_64)'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '15.3.0'
      OperatingSystemVersionMajor          : '15'
      OperatingSystemNameVersion           : 'Darwin (iOS) 15.3.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 15'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'com.ddeville.llwebkit.linkchecker'
      LayoutEngineVersion                  : '1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'com.ddeville.llwebkit.linkchecker 1'
      LayoutEngineNameVersionMajor         : 'com.ddeville.llwebkit.linkchecker 1'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'com.ddeville.llwebkit.linkchecker'
      AgentVersion                         : '1'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'com.ddeville.llwebkit.linkchecker 1'
      AgentNameVersionMajor                : 'com.ddeville.llwebkit.linkchecker 1'

- test:
    input:
      user_agent_string: 'Callpod Keeper for Android 1.0 (10.3.0/245) Dalvik/2.1.0 (Linux; U; Android 6.0; MotoG3 Build/MPI24.65-33)'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Motorola MOTOG3'
      DeviceBrand                          : 'Motorola'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '6.0'
      OperatingSystemVersionMajor          : '6'
      OperatingSystemNameVersion           : 'Android 6.0'
      OperatingSystemNameVersionMajor      : 'Android 6'
      OperatingSystemVersionBuild          : 'MPI24.65-33'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'Callpod Keeper for Android'
      AgentVersion                         : '1.0'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'Callpod Keeper for Android 1.0'
      AgentNameVersionMajor                : 'Callpod Keeper for Android 1'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'com.google.ios.youtube/2.6.0.11251 (iPad3,4; U; CPU iPhone OS 8_1_2 like Mac OS X; nl_NL)'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Apple iPad'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPad (4th gen, Wi-Fi)'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.1.2'
      OperatingSystemVersionMajor          : '8'
      OperatingSystemNameVersion           : 'iOS 8.1.2'
      OperatingSystemNameVersionMajor      : 'iOS 8'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'com.google.ios.youtube'
      AgentVersion                         : '2.6.0.11251'
      AgentVersionMajor                    : '2'
      AgentNameVersion                     : 'com.google.ios.youtube 2.6.0.11251'
      AgentNameVersionMajor                : 'com.google.ios.youtube 2'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'
      AgentSecurity                        : 'Strong security'

# Snapchat on Android
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 7.1.2; Redmi 4X Build/N2G47H; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/66.0.3359.126 Mobile Safari/537.36 Snapchat/10.30.5.0 (Redmi 4X; Android 7.1.2#V9.5.4.0.NAMMIFA#25; gzip)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Xiaomi Redmi 4X'
      DeviceBrand                          : 'Xiaomi'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '7.1.2'
      OperatingSystemVersionMajor          : '7'
      OperatingSystemNameVersion           : 'Android 7.1.2'
      OperatingSystemNameVersionMajor      : 'Android 7'
      OperatingSystemVersionBuild          : 'N2G47H'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '66.0'
      LayoutEngineVersionMajor             : '66'
      LayoutEngineNameVersion              : 'Blink 66.0'
      LayoutEngineNameVersionMajor         : 'Blink 66'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '66.0.3359.126'
      AgentVersionMajor                    : '66'
      AgentNameVersion                     : 'Chrome Webview 66.0.3359.126'
      AgentNameVersionMajor                : 'Chrome Webview 66'
      WebviewAppName                       : 'Snapchat'
      WebviewAppVersion                    : '10.30.5.0'
      WebviewAppVersionMajor               : '10'
      WebviewAppNameVersionMajor           : 'Snapchat 10'


# Snapchat on IPhone
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Snapchat/10.34.1.1 (iPhone9,2; iOS 11.4; gzip)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPhone 7 Plus'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.4'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.4'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.15'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.15'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Browser'
      AgentName                            : 'Snapchat'
      AgentVersion                         : '10.34.1.1'
      AgentVersionMajor                    : '10'
      AgentNameVersion                     : 'Snapchat 10.34.1.1'
      AgentNameVersionMajor                : 'Snapchat 10'


#Instagram on Android 7.1.1
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 7.1.1; Moto G (5S) Build/NPPS26.102-49-4; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/66.0.3359.126 Mobile Safari/537.36 Instagram 42.0.0.19.95 Android (25/7.1.1; 480dpi; 1080x1776; motorola; Moto G (5S); montana_n; qcom; nl_BE; 104766900)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Motorola Moto G (5S)'
      DeviceBrand                          : 'Motorola'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '7.1.1'
      OperatingSystemVersionMajor          : '7'
      OperatingSystemNameVersion           : 'Android 7.1.1'
      OperatingSystemNameVersionMajor      : 'Android 7'
      OperatingSystemVersionBuild          : 'NPPS26.102-49-4'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '66.0'
      LayoutEngineVersionMajor             : '66'
      LayoutEngineNameVersion              : 'Blink 66.0'
      LayoutEngineNameVersionMajor         : 'Blink 66'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '66.0.3359.126'
      AgentVersionMajor                    : '66'
      AgentNameVersion                     : 'Chrome Webview 66.0.3359.126'
      AgentNameVersionMajor                : 'Chrome Webview 66'
      WebviewAppName                       : 'Instagram'
      WebviewAppVersion                    : '42.0.0.19.95'
      WebviewAppVersionMajor               : '42'
      WebviewAppNameVersionMajor           : 'Instagram 42'

#Instagram on iPhone
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 Instagram 43.0.0.13.91 (iPhone8,1; iPhone OS 9_3_5; nl_NL; nl-NL; scale=2.00; gamut=normal; 750x1334)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '13G36'
      DeviceVersion                        : 'iPhone 6s'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.3.5'
      OperatingSystemVersionMajor          : '9'
      OperatingSystemNameVersion           : 'iOS 9.3.5'
      OperatingSystemNameVersionMajor      : 'iOS 9'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '601.1.46'
      LayoutEngineVersionMajor             : '601'
      LayoutEngineNameVersion              : 'AppleWebKit 601.1.46'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 601'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'Instagram'
      AgentVersion                         : '43.0.0.13.91'
      AgentVersionMajor                    : '43'
      AgentNameVersion                     : 'Instagram 43.0.0.13.91'
      AgentNameVersionMajor                : 'Instagram 43'
      AgentLanguage                        : 'Dutch (Netherlands)'
      AgentLanguageCode                    : 'nl-nl'

- matcher:
    extract:
    - 'AgentClass                          :     50 :"Special"'
    - 'AgentName                           :     50 :"iTunes"'
    - 'AgentVersion                        :     50 :agent.(1)product.(1)name="iTunes"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 9; ONEPLUS A6003 Build/PKQ1.180716.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/73.0.3683.90 Mobile Safari/537.36 Instagram 89.0.0.21.101 Android (28/9; 420dpi; 1080x2074; OnePlus; ONEPLUS A6003; OnePlus6; qcom; nl_BE; 150338067)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Oneplus A6003'
      DeviceBrand                          : 'Oneplus'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '9'
      OperatingSystemVersionMajor          : '9'
      OperatingSystemNameVersion           : 'Android 9'
      OperatingSystemNameVersionMajor      : 'Android 9'
      OperatingSystemVersionBuild          : 'PKQ1.180716.001'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '73.0'
      LayoutEngineVersionMajor             : '73'
      LayoutEngineNameVersion              : 'Blink 73.0'
      LayoutEngineNameVersionMajor         : 'Blink 73'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '73.0.3683.90'
      AgentVersionMajor                    : '73'
      AgentNameVersion                     : 'Chrome Webview 73.0.3683.90'
      AgentNameVersionMajor                : 'Chrome Webview 73'
      WebviewAppName                       : 'Instagram'
      WebviewAppVersion                    : '89.0.0.21.101'
      WebviewAppVersionMajor               : '89'
      WebviewAppNameVersionMajor           : 'Instagram 89'
# TODO: Extracting the language from  agent.(7)product.(1)comments.(8)entry.(1)text="nl_BE" is possible but digging this deep will also impact all useragents that do not have this.

- test:
    input:
      user_agent_string: 'iTunes/12.7.4 (Macintosh; OS X 10.13.4) AppleWebKit/605.1.33.1.4'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Apple Macintosh'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS X'
      OperatingSystemVersion               : '10.13.4'
      OperatingSystemVersionMajor          : '10'
      OperatingSystemNameVersion           : 'Mac OS X 10.13.4'
      OperatingSystemNameVersionMajor      : 'Mac OS X 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.33.1.4'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.33.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Special'
      AgentName                            : 'iTunes'
      AgentVersion                         : '12.7.4'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'iTunes 12.7.4'
      AgentNameVersionMajor                : 'iTunes 12'


# NOTE: iTunes makes a complete mess of the Windows desktop OS names
- test:
    input:
      user_agent_string: 'iTunes/12.7.4 (Windows; Microsoft Windows 10 x64 Home Premium Edition (Build 16299); x64) AppleWebKit/7605.1033.1002.2'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemVersionMajor          : '10'
      OperatingSystemNameVersion           : 'Windows 10.0'
      OperatingSystemNameVersionMajor      : 'Windows 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '7605.1033.1002.2'
      LayoutEngineVersionMajor             : '7605'
      LayoutEngineNameVersion              : 'AppleWebKit 7605.1033.1002.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 7605'
      AgentClass                           : 'Special'
      AgentName                            : 'iTunes'
      AgentVersion                         : '12.7.4'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'iTunes 12.7.4'
      AgentNameVersionMajor                : 'iTunes 12'

- test:
    input:
      user_agent_string: 'iTunes/12.7.4 (Windows; Microsoft Windows 10 x64 Home Premium Edition (Build 17134); x64) AppleWebKit/7605.1033.1002.2'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemVersionMajor          : '10'
      OperatingSystemNameVersion           : 'Windows 10.0'
      OperatingSystemNameVersionMajor      : 'Windows 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '7605.1033.1002.2'
      LayoutEngineVersionMajor             : '7605'
      LayoutEngineNameVersion              : 'AppleWebKit 7605.1033.1002.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 7605'
      AgentClass                           : 'Special'
      AgentName                            : 'iTunes'
      AgentVersion                         : '12.7.4'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'iTunes 12.7.4'
      AgentNameVersionMajor                : 'iTunes 12'


- test:
    input:
      user_agent_string: 'iTunes/12.7.4 (Windows; Microsoft Windows 10 x64 Professional Edition (Build 16299); x64) AppleWebKit/7605.1033.1002.2'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '10.0'
      OperatingSystemVersionMajor          : '10'
      OperatingSystemNameVersion           : 'Windows 10.0'
      OperatingSystemNameVersionMajor      : 'Windows 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '7605.1033.1002.2'
      LayoutEngineVersionMajor             : '7605'
      LayoutEngineNameVersion              : 'AppleWebKit 7605.1033.1002.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 7605'
      AgentClass                           : 'Special'
      AgentName                            : 'iTunes'
      AgentVersion                         : '12.7.4'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'iTunes 12.7.4'
      AgentNameVersionMajor                : 'iTunes 12'


- test:
    input:
      user_agent_string: 'iTunes/12.7.4 (Windows; Microsoft Windows 7 Home Premium Edition Service Pack 1 (Build 7601)) AppleWebKit/7605.1033.1002.2'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpuBits                        : '32'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '7'
      OperatingSystemVersionMajor          : '7'
      OperatingSystemNameVersion           : 'Windows 7'
      OperatingSystemNameVersionMajor      : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '7605.1033.1002.2'
      LayoutEngineVersionMajor             : '7605'
      LayoutEngineNameVersion              : 'AppleWebKit 7605.1033.1002.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 7605'
      AgentClass                           : 'Special'
      AgentName                            : 'iTunes'
      AgentVersion                         : '12.7.4'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'iTunes 12.7.4'
      AgentNameVersionMajor                : 'iTunes 12'

- test:
    input:
      user_agent_string: 'iTunes/12.7 (Windows; Microsoft Windows 8.1 x64 Home Premium Edition (Build 9600); x64) AppleWebKit/7604.1038.1006.6'

    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceBrand                          : 'Unknown'
      DeviceCpu                            : 'Intel x86_64'
      DeviceCpuBits                        : '64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : '8.1'
      OperatingSystemVersionMajor          : '8'
      OperatingSystemNameVersion           : 'Windows 8.1'
      OperatingSystemNameVersionMajor      : 'Windows 8'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '7604.1038.1006.6'
      LayoutEngineVersionMajor             : '7604'
      LayoutEngineNameVersion              : 'AppleWebKit 7604.1038.1006.6'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 7604'
      AgentClass                           : 'Special'
      AgentName                            : 'iTunes'
      AgentVersion                         : '12.7'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'iTunes 12.7'
      AgentNameVersionMajor                : 'iTunes 12'

- lookup:
    name: 'AliAppNames'
    map:
      "AP"        : "AlipayClient"
      "TUnionSDK" : "AliApp"

- matcher:
    variable:
    - 'AliApp:agent.product.name[1]="AliApp"^.comments.(1)entry.(1)product'
    require:
    - 'IsNull[LookUp[AliAppNames;@AliApp.name]]'
    extract:
    - 'AgentClass                          :   2018 :"Browser Webview"'
    - 'WebviewAppName                      :   2018 :Concat["Alibaba ";NormalizeBrand[@AliApp.name]]'
    - 'WebviewAppVersion                   :   2018 :@AliApp.version'

- matcher:
    variable:
    - 'AliApp:agent.product.name[2]="AliApp"^.comments.(1)entry.(1)product'
    require:
    - 'IsNull[LookUp[AliAppNames;@AliApp.name]]'
    extract:
    - 'AgentClass                          :   2018 :"Browser Webview"'
    - 'WebviewAppName                      :   2018 :Concat["Alibaba ";NormalizeBrand[@AliApp.name]]'
    - 'WebviewAppVersion                   :   2018 :@AliApp.version'

- matcher:
    variable:
    - 'AliApp:agent.product.name[1]="AliApp"^.comments.(1)entry.(1)product'
    - 'AliAppName:LookUp[AliAppNames;@AliApp.name]'
    extract:
    - 'AgentClass                          :   2019 :"Browser Webview"'
    - 'WebviewAppName                      :   2019 :Concat["Alibaba ";@AliAppName]'
    - 'WebviewAppVersion                   :   2019 :@AliApp.version'

- matcher:
    variable:
    - 'AliApp:agent.product.name[2]="AliApp"^.comments.(1)entry.(1)product'
    - 'AliAppName:LookUp[AliAppNames;@AliApp.name]'
    extract:
    - 'AgentClass                          :   2019 :"Browser Webview"'
    - 'WebviewAppName                      :   2019 :Concat["Alibaba ";@AliAppName]'
    - 'WebviewAppVersion                   :   2019 :@AliApp.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 9; zh-CN; Pixel Build/PPR2.181005.003) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/57.0.2987.108 UCBrowser/11.9.4.974 UWS/2.13.2.36 Mobile Safari/537.36 AliApp(DingTalk/4.5.18.1) com.alibaba.android.rimet/10652535 Channel/10002068 language/zh-CN'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Google Pixel'
      DeviceBrand                          : 'Google'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '9'
      OperatingSystemVersionMajor          : '9'
      OperatingSystemNameVersion           : 'Android 9'
      OperatingSystemNameVersionMajor      : 'Android 9'
      OperatingSystemVersionBuild          : 'PPR2.181005.003'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '57.0'
      LayoutEngineVersionMajor             : '57'
      LayoutEngineNameVersion              : 'Blink 57.0'
      LayoutEngineNameVersionMajor         : 'Blink 57'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '57.0.2987.108'
      AgentVersionMajor                    : '57'
      AgentNameVersion                     : 'Chrome Webview 57.0.2987.108'
      AgentNameVersionMajor                : 'Chrome Webview 57'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      AgentSecurity                        : 'Strong security'
      WebviewAppName                       : 'Alibaba DingTalk'
      WebviewAppVersion                    : '4.5.18.1'
      WebviewAppVersionMajor               : '4'
      WebviewAppNameVersionMajor           : 'Alibaba DingTalk 4'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_2_1 like Mac OS X) AppleWebKit/604.4.7 (KHTML, like Gecko) Mobile/15C153 AliApp(DingTalk/3.5.6) com.laiwang.DingTalk/2697521 Channel/201200 language/en-PT'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15C153'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.2.1'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.2.1'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '604.4.7'
      LayoutEngineVersionMajor             : '604'
      LayoutEngineNameVersion              : 'AppleWebKit 604.4.7'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 604'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '604.4.7'
      AgentVersionMajor                    : '604'
      AgentNameVersion                     : 'AppleWebKit 604.4.7'
      AgentNameVersionMajor                : 'AppleWebKit 604'
      WebviewAppName                       : 'Alibaba DingTalk'
      WebviewAppVersion                    : '3.5.6'
      WebviewAppVersionMajor               : '3'
      WebviewAppNameVersionMajor           : 'Alibaba DingTalk 3'


- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_3_1 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/15E302 UCBrowser/11.8.8.1060 Mobile AliApp(TUnionSDK/0.1.20.2)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15E302'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.3.1'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.3.1'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'UCBrowser'
      LayoutEngineVersion                  : '11.8.8.1060'
      LayoutEngineVersionMajor             : '11'
      LayoutEngineNameVersion              : 'UCBrowser 11.8.8.1060'
      LayoutEngineNameVersionMajor         : 'UCBrowser 11'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UCBrowser'
      AgentVersion                         : '11.8.8.1060'
      AgentVersionMajor                    : '11'
      AgentNameVersion                     : 'UCBrowser 11.8.8.1060'
      AgentNameVersionMajor                : 'UCBrowser 11'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      WebviewAppName                       : 'Alibaba AliApp'
      WebviewAppVersion                    : '0.1.20.2'
      WebviewAppVersionMajor               : '0'
      WebviewAppNameVersionMajor           : 'Alibaba AliApp 0'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iOS 11_2_6 like Mac OS X) AppleWebKit/604.5.6 (KHTML, like Gecko) Mobile/15D100 ChannelId(3) Nebula AliApp(CLOUDMAIL/2.6.8)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.2.6'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.2.6'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '604.5.6'
      LayoutEngineVersionMajor             : '604'
      LayoutEngineNameVersion              : 'AppleWebKit 604.5.6'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 604'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '604.5.6'
      AgentVersionMajor                    : '604'
      AgentNameVersion                     : 'AppleWebKit 604.5.6'
      AgentNameVersionMajor                : 'AppleWebKit 604'
      WebviewAppName                       : 'Alibaba Cloudmail'
      WebviewAppVersion                    : '2.6.8'
      WebviewAppVersionMajor               : '2'
      WebviewAppNameVersionMajor           : 'Alibaba Cloudmail 2'


- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15F79 AliApp(DingTalk/4.5.1) com.laiwang.DingTalk/10127809 Channel/201200 language/zh-Hans-CN'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15F79'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.4'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.4'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.15'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.15'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '605.1.15'
      AgentVersionMajor                    : '605'
      AgentNameVersion                     : 'AppleWebKit 605.1.15'
      AgentNameVersionMajor                : 'AppleWebKit 605'
      AgentLanguage                        : 'Chinese (Simplified Han, China)'
      AgentLanguageCode                    : 'zh-hans-cn'
      WebviewAppName                       : 'Alibaba DingTalk'
      WebviewAppVersion                    : '4.5.1'
      WebviewAppVersionMajor               : '4'
      WebviewAppNameVersionMajor           : 'Alibaba DingTalk 4'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_1_2 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/15B202 UCBrowser/11.8.1.1043 Mobile AliApp(TUnionSDK/0.1.20)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15B202'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.1.2'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.1.2'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'UCBrowser'
      LayoutEngineVersion                  : '11.8.1.1043'
      LayoutEngineVersionMajor             : '11'
      LayoutEngineNameVersion              : 'UCBrowser 11.8.1.1043'
      LayoutEngineNameVersionMajor         : 'UCBrowser 11'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UCBrowser'
      AgentVersion                         : '11.8.1.1043'
      AgentVersionMajor                    : '11'
      AgentNameVersion                     : 'UCBrowser 11.8.1.1043'
      AgentNameVersionMajor                : 'UCBrowser 11'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      WebviewAppName                       : 'Alibaba AliApp'
      WebviewAppVersion                    : '0.1.20'
      WebviewAppVersionMajor               : '0'
      WebviewAppNameVersionMajor           : 'Alibaba AliApp 0'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_3 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/14G60 UCBrowser/11.4.7.931 Mobile AliApp(TUnionSDK/0.1.12) AliApp(TUnionSDK/0.1.12)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '14G60'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '10.3.3'
      OperatingSystemVersionMajor          : '10'
      OperatingSystemNameVersion           : 'iOS 10.3.3'
      OperatingSystemNameVersionMajor      : 'iOS 10'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'UCBrowser'
      LayoutEngineVersion                  : '11.4.7.931'
      LayoutEngineVersionMajor             : '11'
      LayoutEngineNameVersion              : 'UCBrowser 11.4.7.931'
      LayoutEngineNameVersionMajor         : 'UCBrowser 11'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UCBrowser'
      AgentVersion                         : '11.4.7.931'
      AgentVersionMajor                    : '11'
      AgentNameVersion                     : 'UCBrowser 11.4.7.931'
      AgentNameVersionMajor                : 'UCBrowser 11'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      WebviewAppName                       : 'Alibaba AliApp'
      WebviewAppVersion                    : '0.1.12'
      WebviewAppVersionMajor               : '0'
      WebviewAppNameVersionMajor           : 'Alibaba AliApp 0'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13E230 ChannelId(3) Nebula PSDType(1) AlipayDefined(nt:WIFI,ws:320|504|2.0) AliApp(AP/9.9.0.000001) AlipayClient/9.9.0.000001 Language/zh-Hans ProductType/dev'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '13E230'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.3'
      OperatingSystemVersionMajor          : '9'
      OperatingSystemNameVersion           : 'iOS 9.3'
      OperatingSystemNameVersionMajor      : 'iOS 9'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '601.1.46'
      LayoutEngineVersionMajor             : '601'
      LayoutEngineNameVersion              : 'AppleWebKit 601.1.46'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 601'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '601.1.46'
      AgentVersionMajor                    : '601'
      AgentNameVersion                     : 'AppleWebKit 601.1.46'
      AgentNameVersionMajor                : 'AppleWebKit 601'
      WebviewAppName                       : 'Alibaba AlipayClient'
      WebviewAppVersion                    : '9.9.0.000001'
      WebviewAppVersionMajor               : '9'
      WebviewAppNameVersionMajor           : 'Alibaba AlipayClient 9'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iOS 11_2_6 like Mac OS X) AppleWebKit/604.5.6 (KHTML, like Gecko) Mobile/15D100 ChannelId(2) Nebula AliApp(CLOUDMAIL/5.1.0)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.2.6'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.2.6'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '604.5.6'
      LayoutEngineVersionMajor             : '604'
      LayoutEngineNameVersion              : 'AppleWebKit 604.5.6'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 604'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '604.5.6'
      AgentVersionMajor                    : '604'
      AgentNameVersion                     : 'AppleWebKit 604.5.6'
      AgentNameVersionMajor                : 'AppleWebKit 604'
      WebviewAppName                       : 'Alibaba Cloudmail'
      WebviewAppVersion                    : '5.1.0'
      WebviewAppVersionMajor               : '5'
      WebviewAppNameVersionMajor           : 'Alibaba Cloudmail 5'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_4_1 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/15G77 UCBrowser/12.1.2.1096 Mobile AliApp(TUnionSDK/0.1.20.3)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15G77'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.4.1'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.4.1'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'UCBrowser'
      LayoutEngineVersion                  : '12.1.2.1096'
      LayoutEngineVersionMajor             : '12'
      LayoutEngineNameVersion              : 'UCBrowser 12.1.2.1096'
      LayoutEngineNameVersionMajor         : 'UCBrowser 12'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UCBrowser'
      AgentVersion                         : '12.1.2.1096'
      AgentVersionMajor                    : '12'
      AgentNameVersion                     : 'UCBrowser 12.1.2.1096'
      AgentNameVersionMajor                : 'UCBrowser 12'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      WebviewAppName                       : 'Alibaba AliApp'
      WebviewAppVersion                    : '0.1.20.3'
      WebviewAppVersionMajor               : '0'
      WebviewAppNameVersionMajor           : 'Alibaba AliApp 0'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15F79 AliApp(DingTalk/4.5.1) com.laiwang.DingTalk/10127809 Channel/201200 language/en-DE'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15F79'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.4'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.4'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '605.1.15'
      LayoutEngineVersionMajor             : '605'
      LayoutEngineNameVersion              : 'AppleWebKit 605.1.15'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 605'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '605.1.15'
      AgentVersionMajor                    : '605'
      AgentNameVersion                     : 'AppleWebKit 605.1.15'
      AgentNameVersionMajor                : 'AppleWebKit 605'
      AgentLanguage                        : 'English (Germany)'
      AgentLanguageCode                    : 'en-de'
      WebviewAppName                       : 'Alibaba DingTalk'
      WebviewAppVersion                    : '4.5.1'
      WebviewAppVersionMajor               : '4'
      WebviewAppNameVersionMajor           : 'Alibaba DingTalk 4'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.2; SM-N9008 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36 AliApp(AP/8.5.3.012601) AlipayClient/8.5.3.012601'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Samsung SM-N9008'
      DeviceBrand                          : 'Samsung'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.4.2'
      OperatingSystemVersionMajor          : '4'
      OperatingSystemNameVersion           : 'Android 4.4.2'
      OperatingSystemNameVersionMajor      : 'Android 4'
      OperatingSystemVersionBuild          : 'KOT49H'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '30.0'
      LayoutEngineVersionMajor             : '30'
      LayoutEngineNameVersion              : 'Blink 30.0'
      LayoutEngineNameVersionMajor         : 'Blink 30'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '30.0.0.0'
      AgentVersionMajor                    : '30'
      AgentNameVersion                     : 'Chrome Webview 30.0.0.0'
      AgentNameVersionMajor                : 'Chrome Webview 30'
      WebviewAppName                       : 'Alibaba AlipayClient'
      WebviewAppVersion                    : '8.5.3.012601'
      WebviewAppVersionMajor               : '8'
      WebviewAppNameVersionMajor           : 'Alibaba AlipayClient 8'




- test:
#    options:
#    - 'verbose'
#    - 'init'
#    - 'only'
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.4; M353 Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36 AliApp(AP/8.5.3.012601) AlipayClient/8.5.3.012601'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Meizu M353'
      DeviceBrand                          : 'Meizu'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.4.4'
      OperatingSystemVersionMajor          : '4'
      OperatingSystemNameVersion           : 'Android 4.4.4'
      OperatingSystemNameVersionMajor      : 'Android 4'
      OperatingSystemVersionBuild          : 'KTU84P'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '33.0'
      LayoutEngineVersionMajor             : '33'
      LayoutEngineNameVersion              : 'Blink 33.0'
      LayoutEngineNameVersionMajor         : 'Blink 33'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '33.0.0.0'
      AgentVersionMajor                    : '33'
      AgentNameVersion                     : 'Chrome Webview 33.0.0.0'
      AgentNameVersionMajor                : 'Chrome Webview 33'
      WebviewAppName                       : 'Alibaba AlipayClient'
      WebviewAppVersion                    : '8.5.3.012601'
      WebviewAppVersionMajor               : '8'
      WebviewAppNameVersionMajor           : 'Alibaba AlipayClient 8'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_2_6 like Mac OS X; zh-CN) AppleWebKit/537.51.1 (KHTML, like Gecko) Mobile/15D100 UCBrowser/11.9.3.1064 Mobile AliApp(TUnionSDK/0.1.20.2)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Apple iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '15D100'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '11.2.6'
      OperatingSystemVersionMajor          : '11'
      OperatingSystemNameVersion           : 'iOS 11.2.6'
      OperatingSystemNameVersionMajor      : 'iOS 11'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'UCBrowser'
      LayoutEngineVersion                  : '11.9.3.1064'
      LayoutEngineVersionMajor             : '11'
      LayoutEngineNameVersion              : 'UCBrowser 11.9.3.1064'
      LayoutEngineNameVersionMajor         : 'UCBrowser 11'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'UCBrowser'
      AgentVersion                         : '11.9.3.1064'
      AgentVersionMajor                    : '11'
      AgentNameVersion                     : 'UCBrowser 11.9.3.1064'
      AgentNameVersionMajor                : 'UCBrowser 11'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      WebviewAppName                       : 'Alibaba AliApp'
      WebviewAppVersion                    : '0.1.20.2'
      WebviewAppVersionMajor               : '0'
      WebviewAppNameVersionMajor           : 'Alibaba AliApp 0'


# According to https://twitter.com/dannysullivan/status/1092531647319142400
# A new Google useragent spotted named google-speakr - @JohnMu or @dannysullivan any ideas what this is? https://www.seroundtable.com/new-google-useragent-google-speakr-27056.html   via @VorticonCmdr and @gfiorelli1
# That's an useragent used when Google Go fetches a page to make sure it has the most up-to-date information before it translates it to read aloud. We'll see about adding documentation. More info here: https://www.blog.google/technology/next-billion-users/make-google-read-it/

# "Today, were launching a new feature which will let everyone using Google Gos browser listen to webpages out loud."

- matcher:
    require:
    - 'agent="google-speakr"'
    extract:
    - '__Set_ALL_Fields__                  :     99 :"<<<null>>>"' # Must be 1 lower than the rest (or you will wipe yourself too)
    - 'DeviceClass                         :    100 :"Mobile"'
    - 'AgentClass                          :    100 :"Voice"'
    - 'OperatingSystemClass                :    100 :"Mobile"'
    - 'OperatingSystemName                 :    100 :"Android"'
    - 'AgentClass                          :    100 :"Voice"'
    - 'AgentName                           :    100 :"Google Go"'

- test:
    input:
      user_agent_string: 'google-speakr'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Unknown'
      DeviceBrand                          : 'Unknown'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '??'
      OperatingSystemVersionMajor          : '??'
      OperatingSystemNameVersion           : 'Android ??'
      OperatingSystemNameVersionMajor      : 'Android ??'
      AgentClass                           : 'Voice'
      AgentName                            : 'Google Go'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'Google Go ??'
      AgentNameVersionMajor                : 'Google Go ??'


- test:
    input:
      user_agent_string: 'GeenStijlAndroidApp/2.0'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Unknown'
      DeviceBrand                          : 'Unknown'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '??'
      OperatingSystemVersionMajor          : '??'
      OperatingSystemNameVersion           : 'Android ??'
      OperatingSystemNameVersionMajor      : 'Android ??'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'GeenStijlAndroidApp'
      AgentVersion                         : '2.0'
      AgentVersionMajor                    : '2'
      AgentNameVersion                     : 'GeenStijlAndroidApp 2.0'
      AgentNameVersionMajor                : 'GeenStijlAndroidApp 2'

- test:
    input:
      user_agent_string: 'SafeBrowser/1.11.0.38 CFNetwork/974.2.1 Darwin/18.0.0'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '18.0.0'
      OperatingSystemVersionMajor          : '18'
      OperatingSystemNameVersion           : 'Darwin (iOS) 18.0.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 18'
      LayoutEngineClass                    : 'Mobile App'
      LayoutEngineName                     : 'SafeBrowser'
      LayoutEngineVersion                  : '1.11.0.38'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'SafeBrowser 1.11.0.38'
      LayoutEngineNameVersionMajor         : 'SafeBrowser 1'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'SafeBrowser'
      AgentVersion                         : '1.11.0.38'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'SafeBrowser 1.11.0.38'
      AgentNameVersionMajor                : 'SafeBrowser 1'

#
# This is used by iOS to know which app to call for which URL.
# https://shinesolutions.com/2017/06/15/universal-linking-a-few-things-to-be-prepared-for/
#
- matcher:
    require:
    - 'agent.(1)product.(1)name="swcd"'
    extract:
    - 'LayoutEngineClass                   :    100 : "Unknown"' # This thing downloads a single specific Json file.
    - 'LayoutEngineName                    :    100 : "Unknown"'
    - 'LayoutEngineVersion                 :    100 : "??"'
    - 'AgentClass                          :    100 : "Special"'
    - 'AgentName                           :    100 : "Apple iOS Universal Links updater"'
    - 'AgentVersion                        :    100 : agent.product.(1)name="Darwin"^.version'

- test:
    input:
      user_agent_string: 'swcd (unknown version) CFNetwork/758.5.3 Darwin/15.6.0'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Apple iOS Device'
      DeviceBrand                          : 'Apple'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Darwin (iOS)'
      OperatingSystemVersion               : '15.6.0'
      OperatingSystemVersionMajor          : '15'
      OperatingSystemNameVersion           : 'Darwin (iOS) 15.6.0'
      OperatingSystemNameVersionMajor      : 'Darwin (iOS) 15'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      LayoutEngineNameVersion              : 'Unknown ??'
      LayoutEngineNameVersionMajor         : 'Unknown ??'
      AgentClass                           : 'Special'
      AgentName                            : 'Apple iOS Universal Links updater'
      AgentVersion                         : '15.6.0'
      AgentVersionMajor                    : '15'
      AgentNameVersion                     : 'Apple iOS Universal Links updater 15.6.0'
      AgentNameVersionMajor                : 'Apple iOS Universal Links updater 15'


