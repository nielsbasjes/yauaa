#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2016 Niels Basjes
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
config:

- matcher:
    require:
    - 'agent.(1)product.(1)comments.entry.product.(1)name="Browser"^.(1)version="Browser"'
    extract:
    - 'DeviceClass    :   50:"Mobile"'
    - 'DeviceBrand    : 1000:agent.(1)product.(1)comments.entry.product.(1)name="Browser"^<.name'
    - 'DeviceName     : 1000:agent.(1)product.(1)comments.entry.product.(1)name="Browser"^<.(1)version'
    - 'DeviceVersion  : 1000:agent.(1)product.(1)comments.entry.product.(1)name="Browser"^<.(2)version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Macintosh); Intel Mac OS X 10_7_5) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.97 Safari/537.11'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Macintosh'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Intel'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS X'
      OperatingSystemVersion               : '10.7.5'
      OperatingSystemNameVersion           : 'Mac OS X 10.7.5'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.11'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.11'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Chrome'
      AgentVersion                         : '23.0.1271.97'
      AgentVersionMajor                    : '23'
      AgentNameVersion                     : 'Chrome 23.0.1271.97'
      AgentNameVersionMajor                : 'Chrome 23'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 4.2.2; nl-; YC-3135D Build/JDQ39) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'YC-3135D'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.2.2'
      OperatingSystemNameVersion           : 'Android 4.2.2'
      OperatingSystemVersionBuild          : 'JDQ39'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.30'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'Stock Android Browser'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Stock Android Browser 4.0'
      AgentNameVersionMajor                : 'Stock Android Browser 4'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 4.4.2; HUAWEI P7-L10/HuaweiP7-L10C02B129 Browser/Browser/4.4.2) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'P7-L10'
      DeviceBrand                          : 'HUAWEI'
      DeviceVersion                        : 'HuaweiP7-L10C02B129'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.4.2'
      OperatingSystemNameVersion           : 'Android 4.4.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '30.0'
      LayoutEngineVersionMajor             : '30'
      LayoutEngineNameVersion              : 'Blink 30.0'
      LayoutEngineNameVersionMajor         : 'Blink 30'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '30.0.0.0'
      AgentVersionMajor                    : '30'
      AgentNameVersion                     : 'Chrome Webview 30.0.0.0'
      AgentNameVersionMajor                : 'Chrome Webview 30'
      AgentSecurity                        : 'Strong security'
      WebviewAppName                       : 'Unknown Webview App'
      WebviewAppNameVersionMajor           : 'Unknown Webview App ??'
      WebviewAppVersion                    : '??'
      WebviewAppVersionMajor               : '??'

- matcher:
    require:
    - 'agent.(1)product.(1)name%2"Mozilla"'
    - 'agent.(1)product.(1)name%1{"PB"'
    extract:
    - 'AgentClass     :3000:"Browser"'
    - 'AgentName      :3000:"PirateBrowser"'
    - 'AgentVersion   :3000:agent.(1)product.(1)name#2'

- test:
    input:
      user_agent_string: 'PB0.6b Mozilla/5.0 (Windows NT 6.1; WOW64; rv:23.0) Gecko/20100101 Firefox/23.0'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 7'
      OperatingSystemNameVersion           : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '23.0'
      LayoutEngineVersionMajor             : '23'
      LayoutEngineNameVersion              : 'Gecko 23.0'
      LayoutEngineNameVersionMajor         : 'Gecko 23'
      LayoutEngineBuild                    : '20100101'
      AgentClass                           : 'Browser'
      AgentName                            : 'PirateBrowser'
      AgentVersion                         : 'PB0.6b'
      AgentVersionMajor                    : 'PB0'
      AgentNameVersion                     : 'PirateBrowser PB0.6b'
      AgentNameVersionMajor                : 'PirateBrowser PB0'

- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; BTRS31753; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E; staticlogin:product=cboxf2010&act=login&info=ZmlsZW5hbWU9UG93ZXJXb3JkMjAxME94Zl9VbHRpbWF0ZS5leGUmbWFjPTBGRTRFMzZCMUZBNTQ1RTQ5QUZGOEE1QzZDRkNERUEwJnBhc3Nwb3J0PSZ2ZXJzaW9uPTIwMTAuNi4zLjYuMiZjcmFzaHR5cGU9MQ==&verify=cced4bb7457606add430a1b6be544f30; InfoPath.3)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows XP'
      OperatingSystemNameVersion           : 'Windows XP'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '4.0'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Trident 4.0'
      LayoutEngineNameVersionMajor         : 'Trident 4'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '8.0'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Internet Explorer 8.0'
      AgentNameVersionMajor                : 'Internet Explorer 8'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows NT; Win64; x64; rv:26.0) Gecko/20100101 Firefox/26.0 Waterfox/26.0'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      DeviceCpu                            : 'x64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows NT'
      OperatingSystemNameVersion           : 'Windows NT'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '26.0'
      LayoutEngineVersionMajor             : '26'
      LayoutEngineNameVersion              : 'Gecko 26.0'
      LayoutEngineNameVersionMajor         : 'Gecko 26'
      LayoutEngineBuild                    : '20100101'
      AgentClass                           : 'Browser'
      AgentName                            : 'Waterfox'
      AgentVersion                         : '26.0'
      AgentVersionMajor                    : '26'
      AgentNameVersion                     : 'Waterfox 26.0'
      AgentNameVersionMajor                : 'Waterfox 26'


# Notive the SLASHES !!! Must make sure the javacode actually sees them this way !!!
- test:
    input:
      user_agent_string: 'Mozilla/5.0 \\(iPhone; CPU iPhone OS 7_0 like Mac OS X; en-us\\) AppleWebKit/537.51.1 \\(KHTML, like Gecko\\) Version/7.0 Mobile/11A465 Safari/9537.53'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11A465'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.0'
      OperatingSystemNameVersion           : 'iOS 7.0'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.1'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '7.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Safari 7.0'
      AgentNameVersionMajor                : 'Safari 7'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'


# Those { } gave a parse error that hid the rest.
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0; {World Online})'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows Vista'
      OperatingSystemNameVersion           : 'Windows Vista'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Internet Explorer 9.0'
      AgentNameVersionMajor                : 'Internet Explorer 9'

# These gave syntax errors in the 2016-04-01 version
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_2_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13D15; DDG-iOS-709'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '13D15'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.2.1'
      OperatingSystemNameVersion           : 'iOS 9.2.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '601.1.46'
      LayoutEngineVersionMajor             : '601'
      LayoutEngineNameVersion              : 'AppleWebKit 601.1.46'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 601'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '601.1.46'
      AgentVersionMajor                    : '601'
      AgentNameVersion                     : 'AppleWebKit 601.1.46'
      AgentNameVersionMajor                : 'AppleWebKit 601'


# The random text in the comment caused problems
- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; @Oj~?JYJ4Uig}MTTl|@Jr6js/DrNZl@zO/se+/; GTB7.5; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Tablet PC 2.0)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 7'
      OperatingSystemNameVersion           : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '4.0'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Trident 4.0'
      LayoutEngineNameVersionMajor         : 'Trident 4'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '8.0'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Internet Explorer 8.0'
      AgentNameVersionMajor                : 'Internet Explorer 8'

# The lone '-' causes parse errors
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 4.1.2; -; GT-S6810 Build/JZO54K) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'GT-S6810'
      DeviceBrand                          : 'Samsung'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.1.2'
      OperatingSystemNameVersion           : 'Android 4.1.2'
      OperatingSystemVersionBuild          : 'JZO54K'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.30'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'Stock Android Browser'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Stock Android Browser 4.0'
      AgentNameVersionMajor                : 'Stock Android Browser 4'
      AgentSecurity                        : 'Strong security'


# Silk browser
- matcher:
    extract:
    - 'AgentClass            :  50:"Browser"'
    - 'AgentName             :  50:"Silk"'
    - 'AgentVersion          :  50:agent.(1)product.(1)comments.entry.(1)product.(1)name="Silk"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_3; en-us; Silk/1.0.146.3-Gen4_12000410) AppleWebKit/533.16 (KHTML, like Gecko) Version/5.0 Safari/533.16 Silk-Accelerated=true'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Macintosh'
      DeviceBrand                          : 'Apple'
      DeviceCpu                            : 'Intel'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Mac OS X'
      OperatingSystemVersion               : '10.6.3'
      OperatingSystemNameVersion           : 'Mac OS X 10.6.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '533.16'
      LayoutEngineVersionMajor             : '533'
      LayoutEngineNameVersion              : 'AppleWebKit 533.16'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 533'
      AgentClass                           : 'Browser'
      AgentName                            : 'Silk'
      AgentVersion                         : '1.0.146.3-Gen4_12000410'
      AgentVersionMajor                    : '1'
      AgentNameVersion                     : 'Silk 1.0.146.3-Gen4_12000410'
      AgentNameVersionMajor                : 'Silk 1'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'



# Is really SogouMSE,SogouMobileBrowser/4.0.0
- matcher:
    extract:
    - 'AgentClass            :  50:"Browser"'
    - 'AgentName             :  50:"SogouMobileBrowser"'
    - 'AgentVersion          :  50:agent.product.(1)name="SogouMSE,SogouMobileBrowser"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 4.2.1; zh-cn; HUAWEI G610-U00 Build/HuaweiG610-U00) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 SogouMSE,SogouMobileBrowser/4.0.0'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'HUAWEI G610-U00'
      DeviceBrand                          : 'Huawei'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.2.1'
      OperatingSystemNameVersion           : 'Android 4.2.1'
      OperatingSystemVersionBuild          : 'HuaweiG610-U00'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.30'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'SogouMobileBrowser'
      AgentVersion                         : '4.0.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'SogouMobileBrowser 4.0.0'
      AgentNameVersionMajor                : 'SogouMobileBrowser 4'
      AgentLanguage                        : 'Chinese (S)'
      AgentLanguageCode                    : 'zh-cn'
      AgentSecurity                        : 'Strong security'

# This caused a NullPointerException in a previous version.
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.1) Gecko/ /10.0.1'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 7'
      OperatingSystemNameVersion           : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '10.0.1'
      LayoutEngineVersionMajor             : '10'
      LayoutEngineNameVersion              : 'Gecko 10.0.1'
      LayoutEngineNameVersionMajor         : 'Gecko 10'
      LayoutEngineBuild                    : '10.0.1'
      AgentClass                           : 'Browser'
      AgentName                            : 'Gecko'
      AgentVersion                         : '10.0.1'
      AgentVersionMajor                    : '10'
      AgentNameVersion                     : 'Gecko 10.0.1'
      AgentNameVersionMajor                : 'Gecko 10'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) index.html?Referrer=ADVNLGOO0020270001kop Safari/538.1'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Linux Desktop'
      DeviceCpu                            : 'Intel x86_64'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Linux'
      OperatingSystemVersion               : 'Intel x86_64'
      OperatingSystemNameVersion           : 'Linux Intel x86_64'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '538.1'
      LayoutEngineVersionMajor             : '538'
      LayoutEngineNameVersion              : 'AppleWebKit 538.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 538'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '538.1'
      AgentVersionMajor                    : '538'
      AgentNameVersion                     : 'Safari 538.1'
      AgentNameVersionMajor                : 'Safari 538'
      AgentInformationUrl                  : 'index.html?Referrer=ADVNLGOO0020270001kop'

  # Caused a syntax error because of the = in the version of Build
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 4.2.2; WETAB07D04B Build/=WETAB07D04B20140312) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.83 Mobile Safari/537.36'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'WETAB07D04B'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.2.2'
      OperatingSystemNameVersion           : 'Android 4.2.2'
      OperatingSystemVersionBuild          : 'WETAB07D04B20140312'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '47.0'
      LayoutEngineVersionMajor             : '47'
      LayoutEngineNameVersion              : 'Blink 47.0'
      LayoutEngineNameVersionMajor         : 'Blink 47'
      AgentClass                           : 'Browser'
      AgentName                            : 'Chrome'
      AgentVersion                         : '47.0.2526.83'
      AgentVersionMajor                    : '47'
      AgentNameVersion                     : 'Chrome 47.0.2526.83'
      AgentNameVersionMajor                : 'Chrome 47'

  # Has { } parts
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0; {12Move})'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows Vista'
      OperatingSystemNameVersion           : 'Windows Vista'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Internet Explorer 9.0'
      AgentNameVersionMajor                : 'Internet Explorer 9'

  # Has { } parts
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows NT 6.3; Trident/7.0; Noldus B.V. {www.Noldus.com}; rv:11.0) like Gecko'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 8.1'
      OperatingSystemNameVersion           : 'Windows 8.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '7.0'
      LayoutEngineVersionMajor             : '7'
      LayoutEngineNameVersion              : 'Trident 7.0'
      LayoutEngineNameVersionMajor         : 'Trident 7'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '11.0'
      AgentVersionMajor                    : '11'
      AgentNameVersion                     : 'Internet Explorer 11.0'
      AgentNameVersionMajor                : 'Internet Explorer 11'
      AgentInformationUrl                  : 'www.Noldus.com'


# Too many spaces
- test:
    input:
      user_agent_string: 'Mozilla / 5.0 (iPhone; CPU iPhone OS 8_1_2 like Mac OS X) AppleWebKit / 600.1.4 (KHTML, like Gecko) Version / 8.0 Mobile / 12B440 Safari / 600.1.4'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '12B440'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.1.2'
      OperatingSystemNameVersion           : 'iOS 8.1.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'Safari'
      AgentVersion                         : '8.0'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Safari 8.0'
      AgentNameVersionMajor                : 'Safari 8'

# Missing product name
- test:
    input:
      user_agent_string: '/5.0 (Windows; U; Windows NT 5.1; en-ZW) AppleWebKit/534.34 (KHTML, like Gecko)  QtWeb Internet Browser/3.8.5 http://www.QtWeb.net'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows XP'
      OperatingSystemNameVersion           : 'Windows XP'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.34'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.34'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'QtWeb Internet Browser'
      AgentVersion                         : '3.8.5'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'QtWeb Internet Browser 3.8.5'
      AgentNameVersionMajor                : 'QtWeb Internet Browser 3'
      AgentLanguage                        : 'English (Zimbabwe)'
      AgentLanguageCode                    : 'en-zw'
      AgentInformationUrl                  : 'http://www.QtWeb.net'
      AgentSecurity                        : 'Strong security'


- matcher:
    extract:
    - 'AgentClass : 0:"Special"'
    - 'AgentName  : 1:agent.(1)text'

#  - matcher:
#      extract:
#        - 'AgentClass : 0:"Special"'
#        - 'AgentName  : 0:agent'

## Barely anything
#  - test:
#      input:
#        user_agent_string: 'HttpClient'
#      expected:
#        AgentClass                         : 'Special'
#        AgentName                          : 'HttpClient'

## Barely anything
#  - test:
#      input:
#        user_agent_string: 'Go http package'
#      expected:
#        AgentClass                         : 'Special'
#        AgentName                          : 'Go http package'

## Barely anything
#  - test:
#      input:
#        user_agent_string: 'Java1.3.0'
#      expected:
#        AgentClass                         : 'Special'
#        AgentName                          : 'Java1.3.0'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 5.1.1; SM-N920S Build/LMY47X; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/47.0.2526.100 Mobile Safari/537.36;KAKAOTALK 1400218'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'SM-N920S'
      DeviceBrand                          : 'Samsung'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '5.1.1'
      OperatingSystemNameVersion           : 'Android 5.1.1'
      OperatingSystemVersionBuild          : 'LMY47X'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '47.0'
      LayoutEngineVersionMajor             : '47'
      LayoutEngineNameVersion              : 'Blink 47.0'
      LayoutEngineNameVersionMajor         : 'Blink 47'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '47.0.2526.100'
      AgentVersionMajor                    : '47'
      AgentNameVersion                     : 'Chrome Webview 47.0.2526.100'
      AgentNameVersionMajor                : 'Chrome Webview 47'
      WebviewAppName                       : 'Unknown Webview App'
      WebviewAppNameVersionMajor           : 'Unknown Webview App ??'
      WebviewAppVersion                    : '??'
      WebviewAppVersionMajor               : '??'


- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 6.0; Windows 98; PalmSource/hspr-H102; Blazer/4.0) 16;320x320'
    expected:
      # FIXME: Should be PalmSource
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows 9x'
      OperatingSystemVersion               : 'Windows 98'
      OperatingSystemNameVersion           : 'Windows 98'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Internet Explorer'
      LayoutEngineVersion                  : '6.0'
      LayoutEngineVersionMajor             : '6'
      LayoutEngineNameVersion              : 'Internet Explorer 6.0'
      LayoutEngineNameVersionMajor         : 'Internet Explorer 6'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '6.0'
      AgentVersionMajor                    : '6'
      AgentNameVersion                     : 'Internet Explorer 6.0'
      AgentNameVersionMajor                : 'Internet Explorer 6'



- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0); 360Spider(compatible; HaosouSpider; http://www.haosou.com/help/help_3_2.html)'
    expected:
      # FIXME: Should be HaosouSpider
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 7'
      OperatingSystemNameVersion           : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Internet Explorer 9.0'
      AgentNameVersionMajor                : 'Internet Explorer 9'
      AgentInformationUrl                  : 'http://www.haosou.com/help/help_3_2.html'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.4; MI NOTE LTE Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36; leidianbrowser (100.0.2)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'MI NOTE LTE'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.4.4'
      OperatingSystemNameVersion           : 'Android 4.4.4'
      OperatingSystemVersionBuild          : 'KTU84P'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '33.0'
      LayoutEngineVersionMajor             : '33'
      LayoutEngineNameVersion              : 'Blink 33.0'
      LayoutEngineNameVersionMajor         : 'Blink 33'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '33.0.0.0'
      AgentVersionMajor                    : '33'
      AgentNameVersion                     : 'Chrome Webview 33.0.0.0'
      AgentNameVersionMajor                : 'Chrome Webview 33'
      WebviewAppName                       : 'Unknown Webview App'
      WebviewAppNameVersionMajor           : 'Unknown Webview App ??'
      WebviewAppVersion                    : '??'
      WebviewAppVersionMajor               : '??'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 5.1; Z820 Build/LMY47D); AppleWebkit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile Safari/537.36'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Z820'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '5.1'
      OperatingSystemNameVersion           : 'Android 5.1'
      OperatingSystemVersionBuild          : 'LMY47D'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '37.0'
      LayoutEngineVersionMajor             : '37'
      LayoutEngineNameVersion              : 'Blink 37.0'
      LayoutEngineNameVersionMajor         : 'Blink 37'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '37.0.0.0'
      AgentVersionMajor                    : '37'
      AgentNameVersion                     : 'Chrome Webview 37.0.0.0'
      AgentNameVersionMajor                : 'Chrome Webview 37'
      WebviewAppName                       : 'Unknown Webview App'
      WebviewAppNameVersionMajor           : 'Unknown Webview App ??'
      WebviewAppVersion                    : '??'
      WebviewAppVersionMajor               : '??'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0; IEMobile/9.0) 88XI4n5O'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'Generic Windows Phone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Windows Phone'
      OperatingSystemVersion               : '7.5'
      OperatingSystemNameVersion           : 'Windows Phone 7.5'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'IE Mobile'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'IE Mobile 9.0'
      AgentNameVersionMajor                : 'IE Mobile 9'

- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 7.0; Windows Phone OS 7.0; Trident/3.1; IEMobile/7.0; Nokia;N70) 88XI4n5O'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'N70'
      DeviceBrand                          : 'Nokia'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Windows Phone'
      OperatingSystemVersion               : '7.0'
      OperatingSystemNameVersion           : 'Windows Phone 7.0'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Internet Explorer'
      LayoutEngineVersion                  : '7.0'
      LayoutEngineVersionMajor             : '7'
      LayoutEngineNameVersion              : 'Internet Explorer 7.0'
      LayoutEngineNameVersionMajor         : 'Internet Explorer 7'
      AgentClass                           : 'Browser'
      AgentName                            : 'IE Mobile'
      AgentVersion                         : '7.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'IE Mobile 7.0'
      AgentNameVersionMajor                : 'IE Mobile 7'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12F70 - iOSWebview'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '12F70'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.3'
      OperatingSystemNameVersion           : 'iOS 8.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '600.1.4'
      AgentVersionMajor                    : '600'
      AgentNameVersion                     : 'AppleWebKit 600.1.4'
      AgentNameVersionMajor                : 'AppleWebKit 600'


#  - test:
#      input:
#        user_agent_string: 'Java1.0.21.0'

- test:
    input:
      user_agent_string: 'WordPress/3.5; http://smartphone.ro'
    expected:
      DeviceClass                          : 'Robot'
      DeviceName                           : 'Robot'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Cloud'
      OperatingSystemVersion               : 'Cloud'
      OperatingSystemNameVersion           : 'Cloud'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'WordPress'
      AgentVersion                         : '3.5'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'WordPress 3.5'
      AgentNameVersionMajor                : 'WordPress 3'
      AgentInformationUrl                  : 'http://smartphone.ro'

- test:
    input:
      user_agent_string: 'WordPress.com; http://momspiration.nl'
    expected:
      DeviceClass                          : 'Robot'
      DeviceName                           : 'Robot'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Cloud'
      OperatingSystemVersion               : 'Cloud'
      OperatingSystemNameVersion           : 'Cloud'
      LayoutEngineClass                    : 'Unknown'
      LayoutEngineName                     : 'Unknown'
      LayoutEngineVersion                  : '??'
      LayoutEngineVersionMajor             : '??'
      AgentClass                           : 'Special'
      AgentName                            : 'WordPress.com'
      AgentVersion                         : '??'
      AgentVersionMajor                    : '??'
      AgentNameVersion                     : 'WordPress.com ??'
      AgentNameVersionMajor                : 'WordPress.com ??'
      AgentInformationUrl                  : 'http://momspiration.nl'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 4.3; -nl; LT30p Build/9.2.A.1.205) AppleWebKit/537.16 (KHTML, like Gecko) Version/4.0 Mobile Safari/537.16'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'LT30p'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.3'
      OperatingSystemNameVersion           : 'Android 4.3'
      OperatingSystemVersionBuild          : '9.2.A.1.205'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.16'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.16'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Stock Android Browser'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Stock Android Browser 4.0'
      AgentNameVersionMajor                : 'Stock Android Browser 4'
      AgentSecurity                        : 'Strong security'


# FIXME: iOSWebview --> Perhaps this is a webview ...
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_1 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Mobile/11D201 - iOSWebview'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '11D201'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '7.1.1'
      OperatingSystemNameVersion           : 'iOS 7.1.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.2'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '537.51.2'
      AgentVersionMajor                    : '537'
      AgentNameVersion                     : 'AppleWebKit 537.51.2'
      AgentNameVersionMajor                : 'AppleWebKit 537'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (compatible; Abonti/0.91 - http://www.abonti.com)'
    expected:
      DeviceClass                          : 'Robot'
      DeviceName                           : 'Robot'
      OperatingSystemClass                 : 'Cloud'
      OperatingSystemName                  : 'Cloud'
      OperatingSystemVersion               : 'Cloud'
      OperatingSystemNameVersion           : 'Cloud'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Mozilla'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Mozilla 5.0'
      LayoutEngineNameVersionMajor         : 'Mozilla 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Abonti'
      AgentVersion                         : '0.91'
      AgentVersionMajor                    : '0'
      AgentNameVersion                     : 'Abonti 0.91'
      AgentNameVersionMajor                : 'Abonti 0'
      AgentInformationUrl                  : 'http://www.abonti.com'

- matcher:
    extract:
    - 'AgentClass     :    100:"Browser"'
    - 'AgentName      :    100:"Abonti"'
    - 'AgentVersion   :    100:agent.(1)product.(1)comments.entry.(1)product.(1)name="Abonti"^.version'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; compatible; Abonti/0.91 - http://www.abonti.com ; Android 4.3; -nl; LT30p Build/9.2.A.1.205) AppleWebKit/537.51.2 (KHTML, like Gecko) Mobile/11D201 - iOSWebview'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'LT30p'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.3'
      OperatingSystemNameVersion           : 'Android 4.3'
      OperatingSystemVersionBuild          : '9.2.A.1.205'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '537.51.2'
      LayoutEngineVersionMajor             : '537'
      LayoutEngineNameVersion              : 'AppleWebKit 537.51.2'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 537'
      AgentClass                           : 'Browser'
      AgentName                            : 'Abonti'
      AgentVersion                         : '0.91'
      AgentVersionMajor                    : '0'
      AgentNameVersion                     : 'Abonti 0.91'
      AgentNameVersionMajor                : 'Abonti 0'
      AgentInformationUrl                  : 'http://www.abonti.com'
      AgentSecurity                        : 'Strong security'


# Contains __ that breaks the parser
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12F70 Weibo (iPhone6,2__weibo__5.7.1__iphone__os8.3)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '12F70'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.3'
      OperatingSystemNameVersion           : 'iOS 8.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Browser'
      AgentName                            : 'AppleWebKit'
      AgentVersion                         : '600.1.4'
      AgentVersionMajor                    : '600'
      AgentNameVersion                     : 'AppleWebKit 600.1.4'
      AgentNameVersionMajor                : 'AppleWebKit 600'

#The loose '-' in "SM - G900H" caused a parse error
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.2; SM - G900H Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'SM - G900H'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.4.2'
      OperatingSystemNameVersion           : 'Android 4.4.2'
      OperatingSystemVersionBuild          : 'KOT49H'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '30.0'
      LayoutEngineVersionMajor             : '30'
      LayoutEngineNameVersion              : 'Blink 30.0'
      LayoutEngineNameVersionMajor         : 'Blink 30'
      AgentClass                           : 'Browser Webview'
      AgentName                            : 'Chrome Webview'
      AgentVersion                         : '30.0.0.0'
      AgentVersionMajor                    : '30'
      AgentNameVersion                     : 'Chrome Webview 30.0.0.0'
      AgentNameVersionMajor                : 'Chrome Webview 30'
      WebviewAppName                       : 'Unknown Webview App'
      WebviewAppNameVersionMajor           : 'Unknown Webview App ??'
      WebviewAppVersion                    : '??'
      WebviewAppVersionMajor               : '??'


# Parse errors due to missing version values
- test:
    input:
      user_agent_string: 'Lenovo-A750/S102 Linux/2.6.35.7 Android/2.3 Release/12.12.2011 Browser/AppleWebKit533.1 Profile/ Configuration/'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Lenovo-A750'
      DeviceFirmwareVersion                : '12.12.2011'
      DeviceVersion                        : 'S102'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '2.3'
      OperatingSystemNameVersion           : 'Android 2.3'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : 'AppleWebKit533.1'
      LayoutEngineVersionMajor             : 'AppleWebKit533'
      LayoutEngineNameVersion              : 'AppleWebKit AppleWebKit533.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit AppleWebKit533'
      AgentClass                           : 'Special'
      AgentName                            : 'Lenovo-A750'
      AgentVersion                         : 'S102'
      AgentVersionMajor                    : 'S102'
      AgentNameVersion                     : 'Lenovo-A750 S102'
      AgentNameVersionMajor                : 'Lenovo-A750 S102'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_2_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13D15 MOBILE-LEQUIPE/IOS/PHONE/6.9.3/(null)'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '9.2.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '601.1.46'
      LayoutEngineVersionMajor             : '601'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'MOBILE-LEQUIPE'
      AgentVersion                         : 'IOS'
      AgentVersionMajor                    : 'IOS'
      AgentNameVersion                     : 'MOBILE-LEQUIPE IOS'
      AgentNameVersionMajor                : 'MOBILE-LEQUIPE IOS'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '13D15'
      DeviceVersion                        : 'iPhone'
      LayoutEngineNameVersion              : 'AppleWebKit 601.1.46'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 601'
      OperatingSystemNameVersion           : 'iOS 9.2.1'

- test:
    input:
      user_agent_string: 'Opera/9.80 (Android; Opera Mini/7.28879/27.1662; U; en-us) Presto/2.8.119 Version/11.10 UCBrowser/8.4.1.204/145/33567/'
    expected:
      DeviceClass                          : 'Mobile'
      DeviceName                           : 'Android Mobile'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'Android ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Presto'
      LayoutEngineVersion                  : '2.8.119'
      LayoutEngineVersionMajor             : '2'
      LayoutEngineNameVersion              : 'Presto 2.8.119'
      LayoutEngineNameVersionMajor         : 'Presto 2'
      AgentClass                           : 'Browser'
      AgentName                            : 'Opera Mini'
      AgentVersion                         : '7.28879'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Opera Mini 7.28879'
      AgentNameVersionMajor                : 'Opera Mini 7'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'


# Parse error due to value that looks like a BASE64
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 8_0_2 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12A405 rabbit%2F1.0 baiduboxapp/0_0.1.1.7_enohpi_4331_057/2.0.8_2C2%257enohPi/1099a/75301144EBD727E95FF2FCCE44CE285869CC516F1ORDGCCTNPA/1'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'iPhone'
      DeviceBrand                          : 'Apple'
      DeviceFirmwareVersion                : '12A405'
      DeviceVersion                        : 'iPhone'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'iOS'
      OperatingSystemVersion               : '8.0.2'
      OperatingSystemNameVersion           : 'iOS 8.0.2'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '600.1.4'
      LayoutEngineVersionMajor             : '600'
      LayoutEngineNameVersion              : 'AppleWebKit 600.1.4'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 600'
      AgentClass                           : 'Mobile App'
      AgentName                            : 'rabbit%2F1.0 baiduboxapp'
      AgentVersion                         : '0_0.1.1.7_enohpi_4331_057'
      AgentVersionMajor                    : '0'
      AgentNameVersion                     : 'rabbit%2F1.0 baiduboxapp 0_0.1.1.7_enohpi_4331_057'
      AgentNameVersionMajor                : 'rabbit%2F1.0 baiduboxapp 0'

# Parse error about the " 480X854 motorola DROIDX" at the end
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; DROIDX Build/VZW) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1 480X854 motorola DROIDX'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'DROIDX'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '2.2.1'
      OperatingSystemNameVersion           : 'Android 2.2.1'
      OperatingSystemVersionBuild          : 'VZW'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '533.1'
      LayoutEngineVersionMajor             : '533'
      LayoutEngineNameVersion              : 'AppleWebKit 533.1'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 533'
      AgentClass                           : 'Browser'
      AgentName                            : 'Stock Android Browser'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Stock Android Browser 4.0'
      AgentNameVersionMajor                : 'Stock Android Browser 4'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

### TODO: (Low prio) Lots of ; and not comment block
# This would required extra rules
#  - test:
#      input:
#        user_agent_string: 'Mozilla/5.0; iPhone; CPU iPhone OS 8_1_2 like Mac OS X; AppleWebKit/600.1.4; KHTML, like Gecko; Version/8.0 Mobile/12B440 Safari/600.1.4'

# Parse errors due to the "{...}" parts
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Windows; U; Windows NT 6.1; ar; rv:1.9.1) Gecko/20090624 AskTb{TB_NAME}/{TB_VERSION} Firefox/3.5'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 7'
      OperatingSystemNameVersion           : 'Windows 7'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '1.9.1'
      LayoutEngineVersionMajor             : '1'
      LayoutEngineNameVersion              : 'Gecko 1.9.1'
      LayoutEngineNameVersionMajor         : 'Gecko 1'
      LayoutEngineBuild                    : '20090624'
      AgentClass                           : 'Browser'
      AgentName                            : 'Firefox'
      AgentVersion                         : '3.5'
      AgentVersionMajor                    : '3'
      AgentNameVersion                     : 'Firefox 3.5'
      AgentNameVersionMajor                : 'Firefox 3'
      AgentLanguage                        : 'Arabic'
      AgentLanguageCode                    : 'ar'
      AgentSecurity                        : 'Strong security'

# With url encoding ...
- test:
    input:
      user_agent_string: 'Mozilla/5.0%20%28Linux%3B%20Android%206.0.1%3B%20SM-G920F%20Build/MMB29K%29%20AppleWebKit/537.36%20%28KHTML%2C%20like%20Gecko%29%20Chrome/49.0.2623.91%20Mobile%20Safari/537.36 Requester IP: 94.226.145.25'
    expected:
      DeviceClass                          : 'Phone'
      DeviceName                           : 'SM-G920F'
      DeviceBrand                          : 'Samsung'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '6.0.1'
      OperatingSystemNameVersion           : 'Android 6.0.1'
      OperatingSystemVersionBuild          : 'MMB29K'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Blink'
      LayoutEngineVersion                  : '49.0'
      LayoutEngineVersionMajor             : '49'
      LayoutEngineNameVersion              : 'Blink 49.0'
      LayoutEngineNameVersionMajor         : 'Blink 49'
      AgentClass                           : 'Browser'
      AgentName                            : 'Chrome'
      AgentVersion                         : '49.0.2623.91'
      AgentVersionMajor                    : '49'
      AgentNameVersion                     : 'Chrome 49.0.2623.91'
      AgentNameVersionMajor                : 'Chrome 49'

# Lots of quotes half way the useragent
- test:
    input:
      user_agent_string: '"""Mozilla/5.0 (Linux; U; Android 4.2.2; en-us; Lenco 7\"""" tablet Build/JDQ39) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30"""'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'Lenco 7\"""" tablet'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.2.2'
      OperatingSystemNameVersion           : 'Android 4.2.2'
      OperatingSystemVersionBuild          : 'JDQ39'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.30'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'Stock Android Browser'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Stock Android Browser 4.0'
      AgentNameVersionMajor                : 'Stock Android Browser 4'
      AgentLanguage                        : 'English (United States)'
      AgentLanguageCode                    : 'en-us'
      AgentSecurity                        : 'Strong security'

- test:
    input:
      user_agent_string: '"Mozilla/5.0 (Linux; U; Android 4.2.2; de-de; PocketBook SURFpad 3 (7,85\"") Build/JDQ39) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30"'
    expected:
      DeviceClass                          : 'Tablet'
      DeviceName                           : 'PocketBook SURFpad 3 (7,85\"")'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Android'
      OperatingSystemVersion               : '4.2.2'
      OperatingSystemNameVersion           : 'Android 4.2.2'
      OperatingSystemVersionBuild          : 'JDQ39'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'AppleWebKit'
      LayoutEngineVersion                  : '534.30'
      LayoutEngineVersionMajor             : '534'
      LayoutEngineNameVersion              : 'AppleWebKit 534.30'
      LayoutEngineNameVersionMajor         : 'AppleWebKit 534'
      AgentClass                           : 'Browser'
      AgentName                            : 'Stock Android Browser'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Stock Android Browser 4.0'
      AgentNameVersionMajor                : 'Stock Android Browser 4'
      AgentLanguage                        : 'German (Germany)'
      AgentLanguageCode                    : 'de-de'
      AgentSecurity                        : 'Strong security'


# TODO (low prio): Json wrapped useragent
#  - test:
#      input:
#        user_agent_string: "{'User-Agent': 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)'}"

#  - test:
#       input:
#         user_agent_string: "{u'User-Agent': u'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'}"


- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 8.0; Windows 6.3; WOW64; Trident/5.0)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows 8.1'
      OperatingSystemNameVersion           : 'Windows 8.1'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '5.0'
      LayoutEngineVersionMajor             : '5'
      LayoutEngineNameVersion              : 'Trident 5.0'
      LayoutEngineNameVersionMajor         : 'Trident 5'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '9.0'
      AgentVersionMajor                    : '9'
      AgentNameVersion                     : 'Internet Explorer 9.0'
      AgentNameVersionMajor                : 'Internet Explorer 9'

# staticlogin
- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; BTRS31753; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E; staticlogin:product=cboxf2010&act=login&info=ZmlsZW5hbWU9UG93ZXJXb3JkMjAxME94Zl9VbHRpbWF0ZS5leGUmbWFjPTBGRTRFMzZCMUZBNTQ1RTQ5QUZGOEE1QzZDRkNERUEwJnBhc3Nwb3J0PSZ2ZXJzaW9uPTIwMTAuNi4zLjYuMiZjcmFzaHR5cGU9MQ==&verify=cced4bb7457606add430a1b6be544f30; InfoPath.3)'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'Windows NT'
      OperatingSystemVersion               : 'Windows XP'
      OperatingSystemNameVersion           : 'Windows XP'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Trident'
      LayoutEngineVersion                  : '4.0'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Trident 4.0'
      LayoutEngineNameVersionMajor         : 'Trident 4'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '8.0'
      AgentVersionMajor                    : '8'
      AgentNameVersion                     : 'Internet Explorer 8.0'
      AgentNameVersionMajor                : 'Internet Explorer 8'

- test:
    input:
      user_agent_string: 'Mozilla/4.0 (compatible;)'
    expected:
      DeviceClass                          : 'Unknown'
      DeviceName                           : 'Unknown'
      OperatingSystemClass                 : 'Unknown'
      OperatingSystemName                  : 'Unknown'
      OperatingSystemVersion               : '??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Mozilla'
      LayoutEngineVersion                  : '4.0'
      LayoutEngineVersionMajor             : '4'
      LayoutEngineNameVersion              : 'Mozilla 4.0'
      LayoutEngineNameVersionMajor         : 'Mozilla 4'
      AgentClass                           : 'Browser'
      AgentName                            : 'Netscape'
      AgentVersion                         : '4.0'
      AgentVersionMajor                    : '4'
      AgentNameVersion                     : 'Netscape 4.0'
      AgentNameVersionMajor                : 'Netscape 4'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (illumOS; rv:38.0) Gecko/20100101 Firefox/38.0'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'OpenSolaris Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'illumOS'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'illumOS ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '38.0'
      LayoutEngineVersionMajor             : '38'
      LayoutEngineNameVersion              : 'Gecko 38.0'
      LayoutEngineNameVersionMajor         : 'Gecko 38'
      LayoutEngineBuild                    : '20100101'
      AgentClass                           : 'Browser'
      AgentName                            : 'Firefox'
      AgentVersion                         : '38.0'
      AgentVersionMajor                    : '38'
      AgentNameVersion                     : 'Firefox 38.0'
      AgentNameVersionMajor                : 'Firefox 38'

- test:
    input:
      user_agent_string: 'Mozilla/5.0 (Mac; rv:44.0) Gecko/20100101 Firefox/44.0'
    expected:
      DeviceClass                          : 'Unknown'
      DeviceName                           : 'Unknown'
      OperatingSystemClass                 : 'Mobile'
      OperatingSystemName                  : 'Firefox OS'
      OperatingSystemVersion               : '2.5'
      OperatingSystemNameVersion           : 'Firefox OS 2.5'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Gecko'
      LayoutEngineVersion                  : '44.0'
      LayoutEngineVersionMajor             : '44'
      LayoutEngineNameVersion              : 'Gecko 44.0'
      LayoutEngineNameVersionMajor         : 'Gecko 44'
      LayoutEngineBuild                    : '20100101'
      AgentClass                           : 'Browser'
      AgentName                            : 'Firefox'
      AgentVersion                         : '44.0'
      AgentVersionMajor                    : '44'
      AgentNameVersion                     : 'Firefox 44.0'
      AgentNameVersionMajor                : 'Firefox 44'


# Both mac and sunos ... i.e. manually modified.
- test:
    input:
      user_agent_string: 'Mozilla/5.0 (MSIE 7.0; Macintosh; U; SunOS; X11; gu; SV1; InfoPath.2; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648) 88XI4n5O'
    expected:
      DeviceClass                          : 'Desktop'
      DeviceName                           : 'Sun Desktop'
      OperatingSystemClass                 : 'Desktop'
      OperatingSystemName                  : 'SunOS'
      OperatingSystemVersion               : '??'
      OperatingSystemNameVersion           : 'SunOS ??'
      LayoutEngineClass                    : 'Browser'
      LayoutEngineName                     : 'Internet Explorer'
      LayoutEngineVersion                  : '7.0'
      LayoutEngineVersionMajor             : '7'
      LayoutEngineNameVersion              : 'Internet Explorer 7.0'
      LayoutEngineNameVersionMajor         : 'Internet Explorer 7'
      AgentClass                           : 'Browser'
      AgentName                            : 'Internet Explorer'
      AgentVersion                         : '7.0'
      AgentVersionMajor                    : '7'
      AgentNameVersion                     : 'Internet Explorer 7.0'
      AgentNameVersionMajor                : 'Internet Explorer 7'
      AgentLanguage                        : 'Gujarati'
      AgentLanguageCode                    : 'gu'
      AgentSecurity                        : 'Strong security'

# Manipulated to make it look like Windows 7
#  - test:
#      input:
#        user_agent_string: 'Windows 7 (Internet explorer 9) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Safari/537.36 Edge/13.10586'
